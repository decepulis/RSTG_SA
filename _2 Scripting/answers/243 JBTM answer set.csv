body,Asker,Answered,Answered by,,
"I suggest we add a dependency on BYTEMAN-190 for this task. Amos, if you agree, can you add the dependency please? More Actions -> Link -> Depends on",Tom Jenkinson ,1,Amos Feng,,
Please can you add an estimate for this issue?,Tom Jenkinson ,,,,
"Paul, can I delete XTS/localjunit/crash-recovery-tests/check.sh as now we can use maven plugin to check rule ?",Amos Feng ,,,,
Mark I'm not clear on this one. The effective default timeout appears to be 0 regardless of which TransactionManagerImple is used. Am I missing something?,Jonathan Halliday ,1,Mark Little,,
I've just added 4.17.4 to the fix version. Can you cherry-pick your commit from master and raise a pull request on 4.17?,Paul Robinson ,,,,
"A better solution would be to have this problem detected in the AS7 testsuite. This would prevent the error from even being accepted into the AS7 codebase. Ivo, can this type of check be made in the allTests junit suite?",Paul Robinson ,1,Tom Jenkinson ,Who ever makes a change to src/main/resources/standalone/configuration/*xml should be made aware that they should also update src/main/resources/docs/examples/config/*xml,Corelate to RQ3: large size + low coherent
"I would add that I believe this issue can be (not formally, but effectively) resolved through education. Who ever makes a change to src/main/resources/standalone/configuration/*xml should be made aware that they should also update src/main/resources/docs/examples/config/*xml This issue should affect: ./messaging/src/test/resources/standalone-with-messaging.xml ./modcluster/src/test/resources/standalonemodcluster.xml ./build/src/main/resources/docs/examples/configs/standalone-hornetq-colocated.xml ./build/src/main/resources/docs/examples/configs/standalone-xts.xml ./build/src/main/resources/docs/examples/configs/standalone-minimalistic.xml ./build/src/main/resources/docs/examples/configs/standalone-jts.xml ./build/src/main/resources/docs/examples/configs/standalone-osgi-only.xml So I see it as broader than XTS. That said, +1 on checking whether the testsuite can detect it, but I don't know if the other configs are tested during testsuite.",,,,,
"PS, shouldn't this issue be moved to an AS7 Jira?",Tom Jenkinson ,,,,
"Ivo, Of course, I forgot these tests would do this also. Do your tests fail if the server boots with errors, even though XTS is still functioning correctly? We still have the problem where a minor change is forgotten; one which doesn't break XTS and doesn't fail the server boot. However, these are relatively minor and could probably be checked manually every now and then.",Paul Robinson ,1,Ivo Studensky ,,
Can this be moved to an AS7 Jira?,Tom Jenkinson ,1,Paul Robinson ,Not change to another project,
"Sure, but can we re-open issues like this in AS7 project do you think?",Tom Jenkinson ,,,,
"Is this still required? We could do with a better description to explain the actual motivation or leave this closed as ""incomplete description"".",Tom Jenkinson ,,,,
"1. (Slightly unrelated) can we move the XTS demo to quickstarts/? 2. (on topic) Is the idea that the user builds upon the XTS demo or is the restaurant service used for hack/simplicity? If the idea is that we build upon the XTS demo then I think that the dependency (assuming XTS demo is moved to quickstarts) is OK, if the restaurant service is however used out of convenience and the XTS demo is not referenced in any way in associated meta-data (README.md etc) then I think it is a good idea to duplicate the code in the TXBridge demo and break the dependency.",Tom Jenkinson ,1,Paul Robinson,,
"I just put this on HORNETQ-274: Hi I just trawled the the Jira and forum postings I ls'd my .m2/repository/org/hornetq find . -name \pom.xml in the AS7 version of hornetq but can't find the dependency to import for this. Do you know that this work was done? If so, do you happen to know what I should replace: <dependency> <groupId>org.hornetq</groupId> <artifactId>hornetq-core</artifactId> </dependency> with? I also can't find it by grepping the internet, e.g. http://mvnrepository.com/artifact/org.hornetq",Carlo de Wolf,1,Tom Jenkinson,Corelate to RQ3: large size & high coherence,
"Hi Amos, Please can you backport this to the branch? Thanks! Tom",Tom Jenkinson ,1,Amos Feng,,
"Amos, {quote} and now jboss-as version is 7.1.2.SNAPSHOT and jbossts version is 4.16.2.Final {quote} What do you mean by this?",Tom Jenkinson ,1,Amos Feng,,
"Hi, I have updated the config on the jobs to use this new script thanks Amos! Paul, please can you give Amos a pointer on the xts commands? Tom",Tom Jenkinson ,,,,
"Paul, I checkout 5_BRANCH on jboss-as and build fail with following: [ERROR] Failed to execute goal on project jboss-as-transactions: Could not resolve dependencies for project org.jboss.as:jboss-as-transactions:jar:7.1.1.Final: The following artifacts could not be resolved: org.jboss.jbossts:jbossjts:jar:5.0.0.M2-SNAPSHOT, org.jboss.jbossts:jbossjts-integration:jar:5.0.0.M2-SNAPSHOT: Failure to find org.jboss.jbossts:jbossjts:jar:5.0.0.M2-SNAPSHOT in http://repository.jboss.org/nexus/content/groups/public/ was cached in the local repository, resolution will not be reattempted until the update interval of jboss-public-repository-group has elapsed or updates are forced It looks like we should change groupId from ""org.jboss.jbossts"" to ""org.jboss.narayana"" can you confirm this change? Amos",Amos Feng,1,Tom Jenkinson,,
"Amos, Can you give us an update on when this will be ported to the 4.16 branch?",Paul Robinson,,,,
"Paul, I ran these test commands on my machine and it failed with <testcase classname=""com.arjuna.qa.junit.LocalJUnitRunner"" name=""testCallServlet"" time=""0.01""> <error message=""org/apache/commons/logging/LogFactory"" type=""java.lang.NoClassDefFoundError"">java.lang.NoClassDefFoundError: org/apache/commons/logging/LogFactory at org.apache.commons.httpclient.HttpClient.&lt;clinit&gt;(Unknown Source) at com.arjuna.qa.junit.HttpUtils.accessURL(HttpUtils.java:97) at com.arjuna.qa.junit.LocalJUnitRunner.testCallServlet(LocalJUnitRunner.java:40) Caused by: java.lang.ClassNotFoundException: org.apache.commons.logging.LogFactory at java.net.URLClassLoader$1.run(URLClassLoader.java:202) at java.security.AccessController.doPrivileged(Native Method) at java.net.URLClassLoader.findClass(URLClassLoader.java:190) at java.lang.ClassLoader.loadClass(ClassLoader.java:306) at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:301) at java.lang.ClassLoader.loadClass(ClassLoader.java:247) </error> </testcase> did I miss some jars ?",Amos Feng,1,Paul Robinson,,
I think that was fixed by https://issues.jboss.org/browse/JBTM-1086 Have you done an 'svn up' on the 4.16 branch?,Paul Robinson,,,,
I think that the branch version needs to hook in the txbridge tests?,Tom Jenkinson ,1,Amos Feng,,
how about commands on the txbridge tests?,Amos Feng,,,,
"I commented on the pull re the password in narayana.sh, not ideal, can it be externalized into the job config? Also, I commented to say what happens if you are running this locally on a checked out pull, can we make the default that the commenting is disabled and job config enables it?",Tom Jenkinson ,,,,
"Tom, btny-pulls-blacktie and btny-pulls-quickstarts are tied to Windows2008. btny-pulls-documentation will run on any machine (including windows). It's not going to be trivial to get this working on windows: {code} function comment_on_pull { if [ ""$COMMENT_ON_PULL"" = """" ]; then return; fi PULL_NUMBER=$(echo $GIT_BRANCH | awk -F 'pull' '{ print $2 }' | awk -F '/' '{ print $2 }') if [ ""$PULL_NUMBER"" != """" ] then JSON=""{ \""body\"": \""$1\"" }"" curl -d ""$JSON"" -ujbosstm-bot:$BOT_PASSWORD https://api.github.com/repos/$GIT_ACCOUNT/$GIT_REPO/issues/$PULL_NUMBER/comments else echo ""Not a pull request, so not commenting"" fi } {code} I guess the only way to do this is by having the job run cygwin with a bash script that does the above. I don't fancy finding Windows commands for all of the above! WDYT?",Paul Robinson ,1,Tom Jenkinson,,
"in terms of the quickstarts one, I wonder how complex that would be in bat files? It is mainly curl (which I believe can be installed as an exe). We really just need to translate: PULL_NUMBER=$(echo $GIT_BRANCH | awk -F 'pull' '{ print $2 }' | awk -F '/' '{ print $2 }') Again, that looks like it is mainly awk. I bet that can be installed too.",Tom Jenkinson ,,,,
Worth a link to where this was done?,Tom Jenkinson ,,,,
"As workaround is possible to define java opt argument -XX:-UseSplitVerifier Put it to file sharedbuild.xml to the tag <junit> like: <jvmarg value=""-XX:-UseSplitVerifier"" /> I suppose that this problem is caused by the fact that the emma library was compiled with older version of compiler that we are trying to use for compiling TS sources. Some links e.g. here http://stackoverflow.com/questions/7970622/java-7-jvm-verifyerror-in-eclipse Do you think that the workaround is enough for solving this jira or should be tried to recompile emma or dive to some other investigation?",Ondra Chaloupka,1,Jonathan Halliday ,,
Please can you add an estimate for this issue?,Tom Jenkinson ,,,,
"Paul, do you have any experience with setting up jobs on the QE cluster?",Tom Jenkinson ,,,,
"Great, are you working with Paul on resolving the XTS issues? +1 on the JDBC tests",Tom Jenkinson ,1,Paul Robinson ,,
"Hi Mike, This issue was marked as ""Resolved, Done"" but there is no ""Fix Version"" specified. Please can you update the Jira with the version of the software where you fixed this? Also, can you then close the issue (assuming its not an in development version). Thanks, Tom",Tom Jenkinson ,,,,
"Please can you update the status of this Jira to indicate when it will be ready as we intend to release M2 on Monday. Thanks, Tom",Tom Jenkinson ,1,Paul Robinson ,,
I can do this on Sunday (hopefully). The diff looks quite simple. The problem will be testing it. I'm not 100% sure i have IP6 only-mode working properly on my machines and I don't know where Mike is with getting IP6 working on Hudson. Mike: will I be able to test this on Hudson before the Monday release?,Paul Robinson ,1,Michael Musgrove ,,
"I won't be able to test this before Weds. If it's urgent, could someone else test the pull? It sounds like we have many other IPv6 (JBTM-1156) issues that will be pushed to 5.final, so we could push this too and I'll look at it and JBTM-1156 on Weds when I hope to be back to work.",Paul Robinson,,,,
"With recent changes to transactional fileio repo, is this still relevant? Also what about the AS7 RPMs that have already been produced for Fedora: don't they duplicate this?",Mark Little ,1,Tom Jenkinson ,,
Status update please?,Mark Little ,1,Gytis Trikleris ,,
"There are ClientStub in tests of wsat-simple and wsba-participant-completion-simple. so if the client handler chain can be added by txframework automatically, we do not need this stub ?",Amos Feng ,1,Paul Robinson ,,
"Amos, What made you think ""the client handler chain can be added by txframework automatically""? This is a feature we have planned but we don't have it yet. Did you read it in some docs somewhere?",Paul Robinson ,1,Amos Feng ,,
Where did the requirement for a per-tx override come from? Is the existing global config option not sufficient?,Jonathan Halliday,1,Mark Little ,,
I can confirm that the the build started to break was between the following two jboss-as commits. I know this because: FAILED = https://github.com/jbossas/jboss-as/commit/f2d65c311d67c61d953bd17c079f4169c3dbf8aa PASSED = https://github.com/jbossas/jboss-as/commit/55fca1401f399591d009c211205f2e6ef94f876b Please can you start checking the commits inbetween to see which specific commit broke the build?,Tom Jenkinson ,,,,
"Amos, please can you investigate why https://github.com/jbossas/jboss-as/commit/435c862b9514bfcf0a036bb2b916ac3dc63b4f4a would stop the XTS crash recovery tests from working? I noticed somethings to do with ""Reload"" perhaps AS7 has some behaviour that reloads the server automatically now?",Tom Jenkinson ,1,Amos Feng ,,
"Paul, I wonder that the contents of recovery records have only the text or the binary characters ?",Amos Feng ,1,Paul Robinson ,,
"Amos, Has this been done for the docs yet?",Paul Robinson ,1,Amos Feng, & Tom Jenkinson ,
Can we mark this as resolved now?,Tom Jenkinson ,,,,
"Seems to be related to REM3-158. Ivo, I'm on PTO until August 28th. Can you try rebuilding AS7 with XNIO 3.0.6 and then re-testing on the IPv6 node?",Paul Robinson ,,,,
Did this make it into PropertiesFactory?,Mark Little ,1,Gytis Trikleris ,,
What is the use case for this?,Mark Little ,1,Tom Jenkinson, & Michael Musgrove ,
"Thanks for raising this Paul. I would go with jbossts-EAP61-branch417 for the existing jobs. We can never tell what the next EAP is, perhaps Narayana will fold into EAP8 or EAP6.x so I am not sure of the naming for the future job though. Maybe narayana-500 is OK (i.e. don't pin it to an EAP in terms of name)?",Tom Jenkinson ,,,,
"You don't need to branch the quickstart, narayana, or docs branches to create these jobs. Currently 5.x and 4.17 share a common branch (master) so both sets of jobs build against master. The place in which they differ is that 4.17 builds against 4_BRANCH of our jboss-as fork and 5.x against 5_BRANCH. They also differ in what is tested as TXF is only tested in 5.x. I would suggest we create the jobs now, but the problem is that we are going to double the load on Hudson as any change is going to trigger both the EAP61 and the narayana-500 version of the job. The reason why I'm keen to get some narayana 5.x CI is that TXF is currently not getting any CI. Maybe I could just create some TXF jobs in the mean time until this is resolved?",Paul Robinson,1,Tom Jenkinson,,
"Mike, Does that mean that you agree with me that we should resolve this as ""won't fix""?",Paul Robinson,1,Michael Musgrove,vlastimil Elias,
"Hi Paul, this is a duplicate of JBTM-1072 (assigned to you) I think?",Tom Jenkinson ,1,Paul Robinson,vlastimil Elias,
"Hi Mike, In the (ideal) future where everything is in Maven we will need to support -DskipTests in qa/ anyway and this is just one step towards that. It is integrated into trunk now, we can always back it out if it becomes an issue? Maybe the priority can be like this: User sets: -DskipTests - skip all tests User sets: QA_TESTS=1 ./scripts/hudson/narayana.sh -DskipTests - override skipTests for the QA suite? I am trying to make it appear more maven like, it wasn't clear to me that skipTests would not skip all the tests sorry :( I am also thinking what is the most intuitive behaviour for the build. Tom",Tom Jenkinson ,,,vlastimil Elias,
Does this affect all versions or 4.17.1+ in particular?,Tom Jenkinson ,1,Michael Musgrove,,
"Actually, maybe we need that job? it might be worth renaming it as it looks like an old ""unit test"" repeat job named as it is?",Tom Jenkinson ,1,Michael Musgrove,paul closes,
Was this a one-off?,Tom Jenkinson ,1,Michael Musgrove,,
"Hi Mike, This issue was marked as ""Resolved, Done"" but there is no ""Fix Version"" specified. Please can you update the Jira with the version of the software where you fixed this? Also, can you then close the issue (assuming its not an in development version). Thanks, Tom",Tom Jenkinson ,1,Michael Musgrove,,
"If there is commitAsync, there should also be rollbackAsync?",Ales Justin,1,Tom Jenkinson,,
How do I get access to BaseTransaction in AS7? As JNDI lookup (java:jboss/UserTransaction) returns ServerVMClientUserTransaction.,Ales Justin,,,,
When the linked JIRA is ready make sure JTS functions with the JDK orb,Michael Musgrove,,,not need?,
Isn't this out of date now?,Mark Little ,1,Tom Jenkinson,,
"OK, thanks. Does the title of the issue need changing now though? I'm assuming we're not back porting this to AS7 and only focussing on WildFly.",Mark Little ,1,,,
"I guess I need to look into this a bit more, but I think that should be a one-off cost? Not that we shouldn't optimize it as L 1. there could be use cases to deploy JBTM just to run a single transaction then to passivate somehow 2. we may want to support reloading config. 3. we may need to optimize boot time costs But to confirm the priority, I think this should be a one-off cost per boot of the TM? Also, please can you confirm the tool you are using to generate the profile (command line parameters too if possible) and maybe your test case if possible.",,,,,
"Hi Mark, Please can you upload the test you were using and the name of the tool that outputted the profiling information? We can look at tuning TxStats, I am thinking a listener pattern might help? Before that though, the test and profiler settings would be useful. Thanks, Tom",,,,,
"Hi Lin, I tagged it as https://svn.jboss.org/repos/labs/labs/jbosstm/tags/JBOSSTS_4_6_1_GA_CP14 Hope that is OK? Tom",,,,,
"It's worth pointing out that the script is inherited from AS7's build.sh, do you think you could try to raise this ""upstream"" so to speak?",,,,,
Why has this been linked to the JDBC object store work? I'd like to understand the relative priority of this to other tasks.,,,,,
"Thanks, but it still doesn't seem that there is clarity on what exactly is required. What is the problem that we're trying to fix? Is it only for JTA? Until we have answers to these and other questions there's no point in implementing anything.",,,,,
Just wondering if this should be in the Arquillian Transaction Extension Jira instance rather than here?,,,,,
Can we have an update on this?,,,,,
"Can you paste in the commands you used to get those numbers, please?",,,,,
What version of JacORB was used please?,,,,,
What hardware architecture is your CI cluster?,,,,,
"Hi Mike, THANKS for raising this, I keep forgetting! Can we put the output in testoutput/ that way we can have a git ignore on just testoutput rather than testoutput TEST*.txt. Tom",,,,,
"Hi Mike, I had a look at the pull request you closed but when I opened the build output and looked in the http://172.17.131.2/job/btny-pulls-narayana/307/artifact/qa/testoutput-jacorb.zip I couldn't see TEST* in there? Tom",,,,,
The JIRA asks for output to be sent to qa/testoutput (not qa). For a qa run against both orbs if you look in the testoutput directory you will find two zips (testoutput-jacorb.zip and testoutput-idlj.zip) which contain the testoutput directory and the TEST*txt files corresponding to each run. To see it working look at the latest narayana-dualstack job (I did notice that btny-pulls-narayana CI job does not archive testoutput so I have updated that job config). I think I may have misunderstood your requirement. Did you mean move all the TEST*txt files into testoutput but leave the zip files in the qa directory.,,,,,
I happened to notice that this: http://172.17.131.2/view/Narayana+BlackTie/job/JBTM-1382/lastSuccessfulBuild/artifact/qa/testoutput-jacorb.zip didn't have the TEST* in the zip?,,,,,
I have dropbumped the priority as it shouldn't affect the release?,,,,,
Should org.jboss.as.weld.deployment.WeldAttachments be lifted into its own subsystem that doesn't depend on EJB3?,,,,,
I think this is resolved for now. Do you agree Tom?,,,,,
"It should be trivial to do that *today* for JDK orb with profiles as you can activate a profile by the presence of a file, e.g. JAVA_HOME/lib/orb.idl. However, JacORB would be in the classpath unless you specifically disabled it with a different profile so its presence would be guaranteed. Now, in the future when AS7-5582 is implemented, the ""JDK"" orb will be a maven dependency (same as JacORB), i.e. it will be available by default in the classpath. Lets say we made the change today as a convenience until AS7-5582 is available, the question is do we really want to have unpredictable results in the build. Lets say the user attempts this new default, detection based build but does still expect both a JDK orb and JacORB version but we as can't locate orb.idl (say they are on pi) and just build the JacORB version - what would you expect then, log a warning?",,,,,
"Since I'm still receiving the following using the latest JDK 7 build for OSX ... [ERROR] Failed to execute goal org.apache.maven.plugins:maven-surefire-plugin:2.9:test (surefire-idlj) on project jts: Execution surefire-idlj of goal org.apache.maven.plugins:maven-surefire-plugin:2.9:test failed: java.lang.reflect.InvocationTargetException; nested exception is java.lang.reflect.InvocationTargetException: null: com/arjuna/ArjunaOTS/OTSAbstractRecordPOA: com.arjuna.ArjunaOTS.OTSAbstractRecordPOA -> [Help 1] I'm assuming we haven't made the automatic build the default? Building for both ORBs is something that has only just happened. So users currently really don't expect an IDLJ build. However, as a developer what I'd prefer is for the build system to not cr*p out ;-) if it can only find one ORB. If it can't find both and I asked it to build JTS then that's definitely an error. But if I just specify JTS on the build line I think I'm either meaning ""Build JTS with JacORB"" (given the last 7 years of history) or ""Build JTS and I really don't care which ORB you use"". Therefore, I suggest changing the build so that it only fails if it can't find either ORB. If it can't find both ORBs then at the end it should print out a message saying which one failed to build. Plus add a jacorb option to the build to correspond to the idlj option, so someone can specify ""build jacorb only"". This would mean the following: ./build.sh -P jts --> build with any ORB, I really don't care which ./build.sh -P jts idlj --> build with only the IDLJ ORB ./build.sh -P jts jacorb --> build with only JacORB",,,,,
Please can you add a component for this?,,,,,
Please can you add a component for this?,,,,,
Shouldn't this also be fixed for 4.17?,,,,,
"Mark The DTF QA tests have their own (JBoss internal) repo, due to different licencing for the DTF. Can we close this one?",,,,,
Why not store it in git?,,,,,
"Why? Also, will you be testing HTTP versus IIOP initially to get a base?",,,,,
"you are right in your concern and that is what I am trying to address but ineloquently I was thinking more about changes to narayana that need a change to jbosstm somehow being able to test both pulls at once. Maybe we could somehow put convention when you raise a pull request for jbosstm that you can put a comment to say something like: ""requires: https://github.com/jbosstm/jboss-as/pull/217"" We can then somehow use that info in the narayana.sh to pull in that branch rather than 5_BRANCH, what do you think? I know you did some work with using rest to talk to git hub to comment on pulls, could it possibly download the comment for the pull in order to grep it for that info?",,,,,
Please can you add an estimate for this?,,,,,
I think we should just take one of the existing quickstarts from the Narayana quickstart repo (multi-hop or multi-service) and simplify it for the following scenario: 1. Client begins TX 2. Client updates a DB 3. Client invokes service 4. Service updates another DB 5. Client commits TX Where client and Service are both EJBs.,,,,,
It appears that the commit for JBJCA-1011 made it into IronJacamar 1.0.16.Final. Is the quickstart working now? Where do I find it?,,,,,
"I've tried this simple test on windows and it also failed with ""java.io.IOException: Could not delete PATH_TO_TEMP_DIRECTORY/ironjacamar-jdbc.jar"" {code} public class SimpleTest { private static final String JDBC_RAR_FILE_PATH = ""src/main/resources/jdbc-xa.rar""; private static Embedded EMBEDDED; @Test public void test() throws Throwable { EMBEDDED = EmbeddedFactory.create(); EMBEDDED.startup(); EMBEDDED.deploy(getURL(JDBC_RAR_FILE_PATH)); System.out.println(""Test...""); EMBEDDED.undeploy(getURL(JDBC_RAR_FILE_PATH)); EMBEDDED.shutdown(); } private static URL getURL(final String path) throws MalformedURLException { final File f = new File(path); return f.toURI().toURL(); } } {code}",,,,,
"For the record, this is the failure: {code} ------------------------------------------------------------------------------- Test set: org.jboss.narayana.quickstart.jca.model.CustomerDAOTest ------------------------------------------------------------------------------- Tests run: 10, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 2.32 sec <<< FAILURE! org.jboss.narayana.quickstart.jca.model.CustomerDAOTest Time elapsed: 0.063 sec <<< ERROR! java.io.IOException: Could not delete C:\Users\hudson\AppData\Local\Temp\2\iron.jacamar\tmp\jdbc-xa.rar\ironjacamar-jdbc.jar at com.github.fungal.impl.KernelImpl.recursiveDelete(KernelImpl.java:1520) at com.github.fungal.impl.KernelImpl.recursiveDelete(KernelImpl.java:1515) at com.github.fungal.impl.KernelImpl.recursiveDelete(KernelImpl.java:1515) at com.github.fungal.impl.KernelImpl.shutdown(KernelImpl.java:850) at org.jboss.jca.embedded.EmbeddedJCA.shutdown(EmbeddedJCA.java:158) at org.jboss.narayana.quickstart.jca.common.AbstractTest.afterClass(AbstractTest.java:61) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:601) at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:45) at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15) at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:42) at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:36) at org.junit.runners.ParentRunner.run(ParentRunner.java:300) at org.apache.maven.surefire.junit4.JUnit4TestSet.execute(JUnit4TestSet.java:35) at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:146) at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:97) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:601) at org.apache.maven.surefire.booter.ProviderFactory$ClassLoaderProxy.invoke(ProviderFactory.java:103) at $Proxy0.invoke(Unknown Source) at org.apache.maven.surefire.booter.SurefireStarter.invokeProvider(SurefireStarter.java:145) at org.apache.maven.surefire.booter.SurefireStarter.runSuitesInProcess(SurefireStarter.java:87) at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:69) {code}",,,,,
"I think that might be enough information to log a bug report against IronJacamar? Can you link this bug as dependent on the one you raise? Also can you provide the link to the stackoverflow article just in case. Thanks, Tom",,,,,
"Sorry, I must have resolved this a while back, I am certainly not seeing it anymore. I will mark it as Out of Date, let me know if its not fixed. I checked it by running a version of ArjunaJTA/jta/tests/../JTATest.java to throw a runtime in afterCompletion and get this: Sep 19, 2013 2:19:27 PM com.arjuna.ats.internal.jta.resources.arjunacore.SynchronizationImple afterCompletion WARN: ARJUNA016029: SynchronizationImple.afterCompletion - failed for com.hp.mwtests.ts.jta.common.Synchronization@483ee0b7 with exception java.lang.RuntimeException at com.hp.mwtests.ts.jta.common.Synchronization.afterCompletion(Synchronization.java:72) at com.arjuna.ats.internal.jta.resources.arjunacore.SynchronizationImple.afterCompletion(SynchronizationImple.java:96) at com.arjuna.ats.arjuna.coordinator.TwoPhaseCoordinator.afterCompletion(TwoPhaseCoordinator.java:532) at com.arjuna.ats.arjuna.coordinator.TwoPhaseCoordinator.end(TwoPhaseCoordinator.java:101) at com.arjuna.ats.arjuna.AtomicAction.commit(AtomicAction.java:162) at com.arjuna.ats.internal.jta.transaction.arjunacore.TransactionImple.commitAndDisassociate(TransactionImple.java:1170) at com.arjuna.ats.internal.jta.transaction.arjunacore.BaseTransaction.commit(BaseTransaction.java:126) at com.hp.mwtests.ts.jta.basic.JTATest.test(JTATest.java:102) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:606) at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:45) at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15) at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:42) at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20) at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:263) at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:68) at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:47) at org.junit.runners.ParentRunner$3.run(ParentRunner.java:231) at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:60) at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:229) at org.junit.runners.ParentRunner.access$000(ParentRunner.java:50) at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:222) at org.junit.runners.ParentRunner.run(ParentRunner.java:300) at org.eclipse.jdt.internal.junit4.runner.JUnit4TestReference.run(JUnit4TestReference.java:50) at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:467) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:683) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:390) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:197) Sep 19, 2013 2:19:33 PM com.arjuna.ats.arjuna.coordinator.TwoPhaseCoordinator afterCompletion WARN: ARJUNA012127: TwoPhaseCoordinator.afterCompletion - returned failure for SynchronizationImple< 0:ffff7f000001:d16e:523af9d9:9, com.hp.mwtests.ts.jta.common.Synchronization@483ee0b7 > Strangely looking at git blame I can't find anytime this would not have been the case for 16029 :(",,,,,
Does this change represent a possible backward incompatibility?,,,,,
"Elevated to critical, please do downgrade (optional?) if not required.",,,,,
"Paul, is this now out of date? If not the description should be something like ""add a TXFramework version of all relevant quickstarts""",,,,,
Just wondered what had necessitated this? Not that it is a problem but we should record in the Jira why this decision was made.,,,,,
Please can you itemize the dependencies that you are worried about - thanks,,,,,
"Hi Weinan, Please can you provide an update on which dependencies you are worried about? We might be cutting a 4.17.4 soon and would like to hear from you, thanks! Tom",,,,,
"Hi Weinan, No worries, hope you had good PTO. My question is more which of the dependencies that those modules you listed have are you concerned about (i.e. I guess there are some none-JBoss stuff? Thanks! Tom",,,,,
"Hi Weinan, Please can you raise a Jira for the second issue (orb.idl) as we don't see that on our machines, it might be environmental so let us know the OS etc and assign it [~mmusgrov] Please can you raise a pull request for the first one? Thanks! Tom",,,,,
"What do you mean by a remote thread? We should be using interposition in all distributed cases, which means the Synchronisation will be registered with a subordinate coordinator.",,,,,
"Regarding the question about what I meant by the ""remote thread"" case: {quote} <tomjenkinson> smarlow: AS1:EJB1 enlists JPA(XAR1) then calls AS2:EJB2 over JTS <tomjenkinson> smarlow: AS2:EJB2 enlists JPA(XAR2) this is done by a jacorb request processor thread at random <tomjenkinson> smarlow: AS1:EJB1 calls commit on the transaction, JPA(XAR1) afterCompletion is handled in the same thread as before - this is fine - but then the call to AS2 to commit the transaction goes over a different jacorb request processor, now afterCompletion in AS2 is done by a different thread {quote} The above doesn't raise any concurrency concerns since there is no (active) application thread on AS2 at the time that AS2 invokes the Synchronization.afterCompletion. Another case, would be similar to the above but with one difference. AS1:EJB1 enlists JPA(XAR1) then loops on calling AS2:EJB2 over JTS AS2:EJB2 enlists JPA(XAR2) and does processing and returns Looping continues until the transaction times out while current application execution is in AS2:EJB2 or just in AS1:EJB1. I don't think that only checking the reaper thread name covers when the transaction times out when the application thread of execution, is in AS2:EJB2. Question 1: Does the root coordinator (AS1) reaper always handle transaction timeout or can the subordinate coordinator (AS2) reaper also handle transaction timeout? I'm not sure how the subordinate coordinator would handle timeout (maybe by sending an out of band message to its parent coordinator that propagates up to the root coordinator?) Even so, it would be chaotic to have multiple coordinators cancelling the transaction at the same time. Regarding the idea of having globally searchable ""being cancelled"" (I assume you mean by the reaper) list, sounds better than my current ""reaper thread"" name check. The globally searchable list would also cover the second (above) case when the application execution is in AS2:EJB2 while (concurrently) an AS2 background orb thread sees the cancel message from the root coordinator.",,,,,
"When each coordinator handles the timeout, does it also cancel its subordinates (as if the subordinate is one of the resources)? Or is it more like the coordinator times out the subordinate (as a resource) which means blocking until the subordinate has completed the subordinate level (reaper) timing out of its (subordinate) resources? In other words, could the subordinate coordinator Synchronization.afterCompletion() be called from a transport thread ever or only from a reaper thread?",,,,,
"Can you provide more detail to this task, since I thought we already had an SPI?",,,,,
There are a few SPI related issues at the moment. Maybe cross-link them?,,,,,
"Hi Crispin, Please can you: 1. Sign our CLA: https://cla.jboss.org/index.seam (choose JBoss Transactions rather than BlackTie) 2. Raise a pull request for your change? This will then run CI over the proposed enhancement and double check it for us I will then merge the PR after it passes :) Thanks, Tom",,,,,
Please can you add an estimate for this issue?,,,,,
do you know the jbossas jira for this way to deploy a war as module ? does it need more configuration ? just for merge stempconnect and blacktie-admin-servers ear the estimate is 4h,,,,,
I can not access ncl openvpn as my crt has been expired. can you mail me these txt ?,,,,,
"Hi Amos, Please find the log from one of the builds attached, it should point out the issue if you scroll to the bottom. Basically blacktie-wildfly is built _after_ a module called ""build"" that uses it. Maybe move the blacktie module up the list of <module>s or something? Tom",,,,,
Would it be possible for you to push the fix directly without the need for a PR (since it currently breaks all of our builds). Also why aren't we using the wildfly version that is built during the main narayana build.,,,,,
"In HybridSessionImpl::send we call apr_socket_timeout_set(stompConnection->socket, 1); and abandon the send if we don't get the message receipt in time. Where in the code are we doing a blocking wait when the transaction timeout is set?",,,,,
"The attached file shows the problem in action taken from: http://albany/job/blacktie-windows2003/404/ Is it possible that the transaction is expired by the time the timeout for the receive is calculated and so it becomes blocking?? The particular lines of debug of interest are: 2010-08-19 12:56:03,212 [0x00002494] DEBUG (XATMIc :196 ) - receive session: 3 olen: 02B2EA28 flags: 0 2010-08-19 12:56:03,212 [0x00002494] TRACE (TxLogManagerc :125 ) - txx_ttl tx=02B832D8 2010-08-19 12:56:03,212 [0x00002494] TRACE (TxLogControl :231 ) - ENTER ttl=4 ctime=1282218958 now=1282218963 2010-08-19 12:56:03,212 [0x00002494] TRACE (TxLogControl :238 ) - > ttl=-1 2010-08-19 12:56:03,212 [0x00002494] TRACE (TxLogManagerc :132 ) - tx->ttl()=0 2010-08-19 12:56:03,212 [0x00002494] TRACE (XATMIc :183 ) - receive txx_ttl time=0",,,,,
the basic idea I think is to pack server.so(dll) in a .sar and deploy it in JBOSS like a MBean. so we can start/top it with jboss admin console ?,,,,,
"Thanks Tom, 1. we need re-use MDBBlacktieTieService like following: {code} public class CPPXAtmiService extends MDBBlacktieService { native boolean tpservice(byte[] data); public Response tpservice(TPSVCINFO svcinfo) throws ConnectionException, ConfigurationException { /* convert svcinfo to byte[] and pass it to JNI, I'm not sure it is OK */ readEnv(btconfig.xml); // prepare to calculate the path of .so String nativelibname = System.mapLibraryName(""name of so""); System.load(""/path/to/so"" + nativelibname); tpservice(data); /* but how to get the response from jni ? */ } } {code} 2. the C code to implement tpservice {code} JNIEXPORT jboolean JNICALL Java_CPPXatmiService_tpservice(...) { // we can not use socket call such as tpcall or tpsend // tpreturn is OK ? // and how to return or we don't need to return any response ? } {code} Amos",,,,,
"if we have this artifact for the C++ XATMI services, the tpcall in JBoss container don't need to send the message through the HornetQ and just only to load class and call tpservice. This is your means *the benefits of performance (not requiring socket comms between java and C)* ?",,,,,
So is this replacing sockets with JNI calls - I would have expected sockets (domain sockets on unix) to be faster than JNI. Have you considered java NIO memory mapped files which will be faster than both JNI and sockets.,,,,,
"Hi Mike, There are two considerations in this: 1. Performance - Amos, please review Mikes comment ""Have you considered java NIO memory mapped files which will be faster than both JNI and sockets."" 2. Administration - deploying into the AS container for admin seems like it would be easier than managing standalone C processes and an AS? In terms of performance, I am considering the (unlikely, but ramp it down a bit and it might be more likely) case of someone trying to send a 4GB .iso to a service. Would a socket be quicker than JNI call (or your NIO mapped files - out of interest, can these be accessed from C?)? I talked to Andrew Dinn and he thought (maybe my question wasn't phrased well enough to him) that JNI would be faster than socket (we didn't consider NIO). Tom",,,,,
"Great, though it may make the JNI side more complex? I was thinking we were going to pass a byte array and be able to re-use most of atmibroker-* to parse this. I wonder how much more performant ByteBuffers are? Perhaps Amos as we move forward you can evaluate both and update us via the Jira?",,,,,
Please can you add an estimate for this issue?,,,,,
"Hi Mike, you means quickstart/blacktie/integration1 ?",,,,,
"I'm temporarily stopping work on this JIRA since it is not clear whether Ingres will work with BlackTie. The issues I'm stuck on are: 1) Associating two Ingres connections with the same thread causes problems. BlackTie code calls xa_start on each resource and any subsequent SQL statement produces this Ingres error: ""E_LQ00D6 An SQL statement was executed outside the context of an XA transaction (i.e., no valid transaction branch association exists). The transaction branch associated with the current SQL session will be marked ROLLBACK ONLY"" [Note it does not appear to be due to having 2 xa_start calls made from the same thread since I tried the following sequence and got the same error: xa_start RM 1, xa_end RM 1, xa_start RM 2, xa_end RM 2] We could probably live with this restriction by only supporting 1 Ingres connection is a distributed transaction. But we still have the next issue: 2) Starting, xa_start, and suspending, xa_end(TMSUSPEND), a transaction branch in one thread and resuming, xa_start(TMRESUME), it in another thread generates this Ingres error: "" reusing connection ING_BTDB1 (INGRES/OpenDTP session 1) E_LQ00C9 Attempt to switch to a session which is currently active."" Interestingly, Ingres supports other transaction monitors (such as CICs and Tuxedo) by supplying dedicated xa switch's which include non trivial code so they are not just wrappers) which leads me to believe that the default Ingres switch does not support switching branches between threads. [We can't reuse these other switches since, for example, Tux uses a combination of Ingres system database tables and shared memory ipc mechanisms to communicate transaction branch states.] Given that these restrictions are kind of fundamental there ought to be a way round the problems so I'd like to revisit them and will therefore leave the JIRA open for now. The attached tar archive contains a snapshot of the changes to the txfooapp example. There is also a source file useful for test XA support without BlackTie.",,,,,
I think it would make sense for the implementer of this to also work on BLACKTIE-381?,,,,,
How about using rest rather than SOAP?,,,,,
Should this be done as part of the BLACKTIE-381 / BLACKTIE-202 package?,,,,,
ESB = Enterprise Service Bus?,,,,,
"Hi Weinan, I can do this, but is it not ok for these all to be in the root pom in a dependency management section? I thought that was the preferred route for jboss projects? e.g. grep https://github.com/jbosstm/narayana/blob/master/pom.xml for ""common<"" Tom",,,,,
"Hi Tom, because of EAP6 current policy, all the dependency management sections will be removed by VMan automatically (a EAP prod tool), so we have to refer ${project.version} explicitly in the poms. I have done that in EAP6 version, unfortunately I've tried but the patch could not be easily reused on upstream code. I believe we could first have a profile for EAP6, and then just add these version tags for the necessary components, wdyt?",,,,,
"Hi [~weinanli] would you be able to review the pull today do you think? I am hoping to put out a 4.17.4? Thanks, Tom",,,,,
"I just noticed this change in the code and tracked it back to github (no JIRA associated with it, so I couldn't see what the issue was): try { Object syncObject = ((BasicAction.Current() == null) ? getMutex() : BasicAction.Current()); synchronized (this) { synchronized (getMutex()) { synchronized (syncObject) { I'm not sure why this change is in here, but need to check because it doesn't look right. Ignoring the fact that we now have 3 locks being acquired before the actual locksHeld lock, we're also potentially acquiring the same lock twice (syncObject could be getMutex())!",,,,,
"Hi Jesper, Do you want me to pretty-print the flag or is the int enough? I don't think you can OR the flags on delist so the int should be enough? Tom",,,,,
"I was unable to duplicate the problem on jboss-as-8.0.0.Alpha1-SNAPSHOT. I was able to duplicate it on EAP. I agree that printing the stacktrace in this instance is excessively verbose. We are in the process of reworking the transactions SPI and as part of that work I will rationalise the debug logging, however we may not make the changes in time for wildfly 8 release. I have added a link from JBTM-1699 (Changes to the transaction SPI) to make sure we don't loose sight of this JIRA. Would you object to me closing this issue ""as will not fix"".",,,,,
Why focus solely on JTS? Why not support something like this for each component?,,,,,
"How about we do this: Split the PR job into a multi config with the same split as Narayana: MAIN XTS QA_JTA QA_JTS_JACORB QA_JTS_JDKORB These will all be scheduled in a random order, which is annoying if you are willing to merge based on a sub-set of tests. It wastes resources, and causes you to wait longer as the tests you are uninterested in may be scheduled first. The solution is to specify in the description which of the above groups you wish to skip. This is similar to what you mention above, but a bit more course-grained and fits in more neatly with the hudson multi-config approach. You can get the PR description with the following command. There's probably a better approach, but this works: curl -s https://api.github.com/repos/jbosstm/narayana/pulls/279 | grep \""body\"": I don't think it makes sense to allow MAIN to be skipped, and if you want to skip one lot of QA tests, you probably want to skip them all? So how about we just have these two options: skipXTS skipQA We could add more fine-grained options if it proves useful. I don't see the point in specifying who can do this. If a contributor skips some tests that need to pass, we simply tell them to update the description and re-test.",,,,,
"How about if the pull just changes a JacORB qa test? Or just an XTS test, that would be rationale to skip MAIN wouldn't it? Agreed on the white listing, we just need to be vigilant :)",,,,,
"That should be fine, I presume they wouldn't have to ""comment_on_pull"" as the variable can be checked before so the pull request comments won't include erroneous ""Tests passed"". Indeed, perhaps they could comment ""XTS tests skipped as per request"" if we wanted it to?",,,,,
"Assign this to me, as I think I know what the problem is?",,,,,
"Hi Weinan, I was under the impression that [~pgier] did not want specific EAP profiles creating? I am happy to create a profile that triggers these modules but as I say, I just want to check it is of use first. Thanks, Tom",,,,,
"Please can you clarify the reason to disable the maven-surefire-plugin? If it is still needed, please can you raise a separate Jira for this one?",,,,,
"Also, build-helper is required to create the uber jars, if this is not possible, please can you raise a separate issue and we can keep this one as the ""findbugs"" issue which I can resolve assuming the tests pass?",,,,,
"[~tomjenkinson], maybe this would be worth pushing to 5.next?",,,,,
How is this different to JBTM-1107? Should we close this as a duplicate?,,,,,
"I think we should just close it and add it into the details for JBTM-1107 as it seems somewhat intrinsic to the behaviour. If you agree, please can you make the change?",,,,,
Please can you add an estimate for this?,,,,,
Which profiles do your team regularly use? I guess we should keep just the most commonly used ones?,,,,,
"I would be happy to remove: all, core, jta, jts, jts-idlj and stm from /pom.xml [~marklittle] does use ""mvn install -Pstm"", but perhaps he will be happy to use: ""mvn install -pl STM -am"" instead? Leave it with me and I will raise the pull request if Mark is happy to stop using the profile. For completeness, this is what would be replaced: all (as used in EAP builds) = mvn install core = mvn install -am -pl ArjunaCore/arjunacore jta = mvn install -am -pl ArjunaJTA/narayana-jta jts = mvn install -am -pl ArjunaJTS/narayana-jts-jacorb jts-idlj = mvn install -am -pl ArjunaJTS/narayana-jts-idlj -Didlj-enabled=true stm = mvn install -am -pl stm",,,,,
"{quote} we are using a custom fork but only for community testing {quote} That's what our thirdparty-releases repository [1] is for, so ideally we should upload the patched release there. Were the patches also submitted to upstream emma so they can get into a future release? Moving the emma tests to a profile would be good. [1]https://community.jboss.org/wiki/MavenDeployingaThirdpartyRelease",,,,,
"Hi Weinan, We left as much of the old builds directory structure in place as maven could cope with. Please can you clarify if there is an EAP issue with the code in these folders as we have previously decided not to make cosmetic changes to the structure? Tom",,,,,
"Hi Tom, I'm working on this with Paul one by one. After I change the dir structure of one component, I'll rerun mvn install on whole project to make sure I don't break anything. For what I've seen most of these legacy components could be restructured to maven standard one. If there are some more complex situations we could discuss on it then, wdyt?",,,,,
Should we link this to JBTM-1970 as well?,,,,,
"Hi, Could you please confirm, can we use JBossTS 4.3.GA release for above mentioned problem. Thanks, Sube",,,,,
Is there a pull request for this on WildFly or does it require M5?,,,,,
In what way did it break the build? I thought I had built everything when I changed this yesterday.,,,,,
"Hi Paul, The dir name and artifact id are effectively fixed at the moment. However, as you say we have more flexibility on the ""project name"" field. Can you update your table with an example of your preferred project name for those modules you have referenced originally, please? Thanks, Tom",,,,,
"Hi Paul, is the ""Narayana: "" prefix implied and therefore a little redundant (I realise I added the redundancy myself with JBossJTS, so just trying to get your opinion here)? if not the table looks good to me - thanks!",,,,,
"Tom, I have a question: Shall a rename the prefix from ""Narayana: "" to ""JBossTS"" for branch 4.17?",,,,,
"Hi Weinan, I think that would be best, if you didn't mind? Thanks, Tom",,,,,
"Hi Mike, This issue was marked as ""Resolved, Done"" but there is no ""Fix Version"" specified. Please can you update the Jira with the version of the software where you fixed this? Also, can you then close the issue (assuming its not an in development version). Thanks, Tom",,,,,
Is this not something that the build can automate?,,,,,
"Hi Tom, [tom@dhcppc1 quickstart]((4.17.4.Final)) $ git name-rev HEAD HEAD tags/4.17.4.Final [tom@dhcppc1 quickstart]((4.17.4.Final)) $ find . -name \pom.xml -exec grep -l 4.17.5 {} \; [tom@dhcppc1 quickstart]((4.17.4.Final)) $ I can't find any reference to 4.17.5 on that tag (SNAPSHOT or otherwise). Can you try to find which file has that reference in? Maybe somehow your repo is corrupted? Tom",,,,,
"Hi Paul, Can you list the files that are in the uber jars but not in the individual jars? The AS currently just consumes the uber jars so I want to make sure when we move to using the individual jars in the AS we can anticipate any further modifications required. Thanks, Tom",,,,,
"1. I now have the DTF running on my laptop and executing simple test cases. This involved: * setting up the MySQL database with the appropriate username, password, database and tables to allow those components of the DTF which make use of the database to access it * setting up Tomcat with (i) the appropriate server.xml configuration to allow defining the proper context for the DTF (servlet invoker, JDBC resource, SMTP env property, welcome file for default.jsp) and (ii) the DTFweb jsp pages and servlets in the correct location * patching the DTF_3_9 source code in appropriate places to allow the DTF to start up correctly * reworking all the DTF configuration files (run_coordinator.sh, coordinator.xml, and the like) so that the DTF installs with a configuration suitable for running off a laptop, with local references to libraries (as opposed to picking up classes from the Tomcat repository) * defining some JUnit test cases which can be used to test the integrity of DTF services individually (i.e. Coordinator, ProductRepository, etc) * reworked the DTF build to make it more user-friendly and added in parts of the build which were missing (e.g. compilation of LinuxProcessHandler.c) At present, the test cases being executed are simple DTF native test cases. I hope to have more substantial test cases running in the next few days.",,,,,
"I have movd the DTF to the QA Labs machines. A database called dtf has been set up on a MySQL server on dev02.qa.atl.jboss.com. I have installed a copy of Tomcat in my home directory on the labs machines, with the following node pool: dev04: runs the DTF executive (NameServer, Coordinator, ServiceManager, ProductRepository, ResultsCollator) and one TestNode dev02: runs one TestNode The DTFweb user interface starts up correctly using the URL http://dev04:8080/dtf. Initiation of test nodes, product deployment, work fine under the control of the DTFweb user interface. However test cases which work on my local machine fail to work correctly when run on the QA Labs machines. There seems to be a problem with (i) receiving output from tasks and (ii) the results of the tests. I am investigating these problems.",,,,,
"Tom, I was thinking that this would be good for Amos to investigate. Can you add any ideas you may have to the above text and then assign accordingly?",,,,,
Maybe this isn't worth the bother? How about we split the job up into 5 1hr pieces and defer this task until we are in a position where we are using too much CI time?,,,,,
Did this get resolved? I saw some commits on the 4.17 branch,,,,,
"I have executed this test locally and it succeeds once executed alone or with idlj tests only. However, if both jacorb and idlj is enabled this test fails. Here is the outcome: {code} Jul 03, 2013 1:48:11 PM com.arjuna.ats.internal.jts.orbspecific.javaidl.recoverycoordinators.JavaIdlRCServiceInit initORBandOA INFO: ARJUNA022087: RecoveryServer using existing ORB Jul 03, 2013 1:48:12 PM com.sun.corba.se.impl.orb.ORBDataParserImpl getPersistentServerId WARNING: ""IOP00910206: (INITIALIZE) Persistent server ID is not set"" org.omg.CORBA.INITIALIZE: vmcid: SUN minor code: 206 completed: Maybe at com.sun.corba.se.impl.logging.ORBUtilSystemException.persistentServeridNotSet(ORBUtilSystemException.java:3643) at com.sun.corba.se.impl.logging.ORBUtilSystemException.persistentServeridNotSet(ORBUtilSystemException.java:3657) at com.sun.corba.se.impl.orb.ORBDataParserImpl.getPersistentServerId(ORBDataParserImpl.java:307) at com.sun.corba.se.impl.oa.poa.POAPolicyMediatorBase.<init>(POAPolicyMediatorBase.java:107) at com.sun.corba.se.impl.oa.poa.POAPolicyMediatorImpl_NR_UDS.<init>(POAPolicyMediatorImpl_NR_UDS.java:52) at com.sun.corba.se.impl.oa.poa.POAPolicyMediatorFactory.create(POAPolicyMediatorFactory.java:45) at com.sun.corba.se.impl.oa.poa.POAImpl.initialize(POAImpl.java:383) at com.sun.corba.se.impl.oa.poa.POAImpl.create_POA(POAImpl.java:799) at com.arjuna.ats.internal.jts.orbspecific.javaidl.recoverycoordinators.JavaIdlRCServiceInit.getRCPOA(JavaIdlRCServiceInit.java:110) at com.arjuna.ats.internal.jts.orbspecific.javaidl.recoverycoordinators.JavaIdlRCServiceInit.startRCservice(JavaIdlRCServiceInit.java:177) at com.hp.mwtests.ts.jts.orbspecific.recovery.JavaIdlRecoveryUnitTest.testInit(JavaIdlRecoveryUnitTest.java:74) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:601) at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:45) at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15) at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:42) at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20) at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28) at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:30) at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:263) at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:68) at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:47) at org.junit.runners.ParentRunner$3.run(ParentRunner.java:231) at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:60) at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:229) at org.junit.runners.ParentRunner.access$000(ParentRunner.java:50) at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:222) at org.junit.runners.ParentRunner.run(ParentRunner.java:300) at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:252) at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:141) at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:112) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:601) at org.apache.maven.surefire.util.ReflectionUtils.invokeMethodWithArray(ReflectionUtils.java:189) at org.apache.maven.surefire.booter.ProviderFactory$ProviderProxy.invoke(ProviderFactory.java:165) at org.apache.maven.surefire.booter.ProviderFactory.invokeProvider(ProviderFactory.java:85) at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:115) at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:75) Jul 03, 2013 1:48:12 PM com.arjuna.ats.internal.jts.orbspecific.javaidl.recoverycoordinators.JavaIdlRCServiceInit getRCPOA WARN: ARJUNA022081: Failed to create poa for recoverycoordinators org.omg.CORBA.INITIALIZE: vmcid: SUN minor code: 206 completed: Maybe at com.sun.corba.se.impl.logging.ORBUtilSystemException.persistentServeridNotSet(ORBUtilSystemException.java:3643) at com.sun.corba.se.impl.logging.ORBUtilSystemException.persistentServeridNotSet(ORBUtilSystemException.java:3657) at com.sun.corba.se.impl.orb.ORBDataParserImpl.getPersistentServerId(ORBDataParserImpl.java:307) at com.sun.corba.se.impl.oa.poa.POAPolicyMediatorBase.<init>(POAPolicyMediatorBase.java:107) at com.sun.corba.se.impl.oa.poa.POAPolicyMediatorImpl_NR_UDS.<init>(POAPolicyMediatorImpl_NR_UDS.java:52) at com.sun.corba.se.impl.oa.poa.POAPolicyMediatorFactory.create(POAPolicyMediatorFactory.java:45) at com.sun.corba.se.impl.oa.poa.POAImpl.initialize(POAImpl.java:383) at com.sun.corba.se.impl.oa.poa.POAImpl.create_POA(POAImpl.java:799) at com.arjuna.ats.internal.jts.orbspecific.javaidl.recoverycoordinators.JavaIdlRCServiceInit.getRCPOA(JavaIdlRCServiceInit.java:110) at com.arjuna.ats.internal.jts.orbspecific.javaidl.recoverycoordinators.JavaIdlRCServiceInit.startRCservice(JavaIdlRCServiceInit.java:177) at com.hp.mwtests.ts.jts.orbspecific.recovery.JavaIdlRecoveryUnitTest.testInit(JavaIdlRecoveryUnitTest.java:74) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:601) at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:45) at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15) at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:42) at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20) at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28) at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:30) at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:263) at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:68) at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:47) at org.junit.runners.ParentRunner$3.run(ParentRunner.java:231) at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:60) at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:229) at org.junit.runners.ParentRunner.access$000(ParentRunner.java:50) at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:222) at org.junit.runners.ParentRunner.run(ParentRunner.java:300) at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:252) at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:141) at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:112) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:601) at org.apache.maven.surefire.util.ReflectionUtils.invokeMethodWithArray(ReflectionUtils.java:189) at org.apache.maven.surefire.booter.ProviderFactory$ProviderProxy.invoke(ProviderFactory.java:165) at org.apache.maven.surefire.booter.ProviderFactory.invokeProvider(ProviderFactory.java:85) at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:115) at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:75) Jul 03, 2013 1:48:12 PM com.arjuna.ats.internal.jts.orbspecific.javaidl.recoverycoordinators.JavaIdlRCServiceInit initORBandOA INFO: ARJUNA022087: RecoveryServer using existing ORB Jul 03, 2013 1:48:12 PM com.sun.corba.se.impl.orb.ORBDataParserImpl getPersistentServerId WARNING: ""IOP00910206: (INITIALIZE) Persistent server ID is not set"" org.omg.CORBA.INITIALIZE: vmcid: SUN minor code: 206 completed: Maybe at com.sun.corba.se.impl.logging.ORBUtilSystemException.persistentServeridNotSet(ORBUtilSystemException.java:3643) at com.sun.corba.se.impl.logging.ORBUtilSystemException.persistentServeridNotSet(ORBUtilSystemException.java:3657) at com.sun.corba.se.impl.orb.ORBDataParserImpl.getPersistentServerId(ORBDataParserImpl.java:307) at com.sun.corba.se.impl.oa.poa.POAPolicyMediatorBase.<init>(POAPolicyMediatorBase.java:107) at com.sun.corba.se.impl.oa.poa.POAPolicyMediatorImpl_NR_UDS.<init>(POAPolicyMediatorImpl_NR_UDS.java:52) at com.sun.corba.se.impl.oa.poa.POAPolicyMediatorFactory.create(POAPolicyMediatorFactory.java:45) at com.sun.corba.se.impl.oa.poa.POAImpl.initialize(POAImpl.java:383) at com.sun.corba.se.impl.oa.poa.POAImpl.create_POA(POAImpl.java:799) at com.arjuna.ats.internal.jts.orbspecific.javaidl.recoverycoordinators.JavaIdlRCServiceInit.getRCPOA(JavaIdlRCServiceInit.java:110) at com.arjuna.ats.internal.jts.orbspecific.javaidl.recoverycoordinators.JavaIdlRCServiceInit.startRCservice(JavaIdlRCServiceInit.java:177) at com.hp.mwtests.ts.jts.orbspecific.recovery.JavaIdlRecoveryUnitTest.testRecoveryInit(JavaIdlRecoveryUnitTest.java:86) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:601) at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:45) at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15) at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:42) at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20) at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28) at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:30) at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:263) at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:68) at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:47) at org.junit.runners.ParentRunner$3.run(ParentRunner.java:231) at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:60) at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:229) at org.junit.runners.ParentRunner.access$000(ParentRunner.java:50) at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:222) at org.junit.runners.ParentRunner.run(ParentRunner.java:300) at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:252) at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:141) at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:112) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:601) at org.apache.maven.surefire.util.ReflectionUtils.invokeMethodWithArray(ReflectionUtils.java:189) at org.apache.maven.surefire.booter.ProviderFactory$ProviderProxy.invoke(ProviderFactory.java:165) at org.apache.maven.surefire.booter.ProviderFactory.invokeProvider(ProviderFactory.java:85) at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:115) at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:75) Jul 03, 2013 1:48:12 PM com.arjuna.ats.internal.jts.orbspecific.javaidl.recoverycoordinators.JavaIdlRCServiceInit getRCPOA WARN: ARJUNA022081: Failed to create poa for recoverycoordinators org.omg.CORBA.INITIALIZE: vmcid: SUN minor code: 206 completed: Maybe at com.sun.corba.se.impl.logging.ORBUtilSystemException.persistentServeridNotSet(ORBUtilSystemException.java:3643) at com.sun.corba.se.impl.logging.ORBUtilSystemException.persistentServeridNotSet(ORBUtilSystemException.java:3657) at com.sun.corba.se.impl.orb.ORBDataParserImpl.getPersistentServerId(ORBDataParserImpl.java:307) at com.sun.corba.se.impl.oa.poa.POAPolicyMediatorBase.<init>(POAPolicyMediatorBase.java:107) at com.sun.corba.se.impl.oa.poa.POAPolicyMediatorImpl_NR_UDS.<init>(POAPolicyMediatorImpl_NR_UDS.java:52) at com.sun.corba.se.impl.oa.poa.POAPolicyMediatorFactory.create(POAPolicyMediatorFactory.java:45) at com.sun.corba.se.impl.oa.poa.POAImpl.initialize(POAImpl.java:383) at com.sun.corba.se.impl.oa.poa.POAImpl.create_POA(POAImpl.java:799) at com.arjuna.ats.internal.jts.orbspecific.javaidl.recoverycoordinators.JavaIdlRCServiceInit.getRCPOA(JavaIdlRCServiceInit.java:110) at com.arjuna.ats.internal.jts.orbspecific.javaidl.recoverycoordinators.JavaIdlRCServiceInit.startRCservice(JavaIdlRCServiceInit.java:177) at com.hp.mwtests.ts.jts.orbspecific.recovery.JavaIdlRecoveryUnitTest.testRecoveryInit(JavaIdlRecoveryUnitTest.java:86) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:601) at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:45) at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15) at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:42) at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20) at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28) at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:30) at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:263) at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:68) at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:47) at org.junit.runners.ParentRunner$3.run(ParentRunner.java:231) at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:60) at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:229) at org.junit.runners.ParentRunner.access$000(ParentRunner.java:50) at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:222) at org.junit.runners.ParentRunner.run(ParentRunner.java:300) at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:252) at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:141) at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:112) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:601) at org.apache.maven.surefire.util.ReflectionUtils.invokeMethodWithArray(ReflectionUtils.java:189) at org.apache.maven.surefire.booter.ProviderFactory$ProviderProxy.invoke(ProviderFactory.java:165) at org.apache.maven.surefire.booter.ProviderFactory.invokeProvider(ProviderFactory.java:85) at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:115) at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:75) {code}",,,,,
How are you running the test. The following syntax used to work but not anymore: {code} ./build.sh -f ArjunaJTS/pom.xml test -Dtest=com.hp.mwtests.ts.jts.orbspecific.recovery.JavaIdlRecoveryUnitTest -Didlj-enabled {code},,,,,
"The reason in the difference in the tests is because if JacORB runs first it has put its RC entry in the object store. You can replicate the issue by using the ObjectStore in the attached jacorb-rc-in-object-store.tgz. If you put it as ArjunaJTS/jts/target/test-classes/ObjectStore then even ""./build.sh -f ArjunaJTS/jts/pom.xml test -Dtest=JavaIdlRecoveryUnitTest -Didlj-enabled"" would fail. iirc the RC manager uses a known UID hence why running JacORB then JDKORB in the same ObjectStore will be a problem. If you notice, the specific test that fails isn't actually the one that is generated in the log you pasted, so success or fail you get those log messages. i.e. those log messages come from tests where failure is expected. That being said, I don't know if there are any tests where success is expected - we should make sure we have some of those as that log message implies that the JDK orb hasn't been configured correctly. i.e. do we have a test that correctly initializes a JDK ORB RC manager? The only tests I see in JavaIdlRecoveryUnitTest are testing failure scenarios.",,,,,
"Conversation with Gytis on a potential solution: pfrobinson: whilst you are at it, can you have a quick check to see if you can add modules to the classloader in that phase too? [12:06pm] gytist: you mean dependencies like org.jboss.xts? [12:10pm] pfrobinson: yeah [12:10pm] pfrobinson: I want to scan for the use of @Transactional and then add the org.jboss.jts depenedency to the deployment [12:10pm] gytist: I think it is, some of the subsystems automatically add dependencies [12:11pm] pfrobinson: yeah, that was my thoughts too [12:11pm] pfrobinson: for example, if persistence.xml is present, you add the jpa deps [12:11pm] gytist: I saw it when I was researching my issue on Monday [12:11pm] gytist: need to find it again [12:12pm] gytist: grep for this class WSDependenciesProcessor [12:12pm] gytist: that's what you need [12:12pm] pfrobinson: great, thanks",,,,,
"Done in 4.17 using EAP: https://github.com/jbosstm/quickstart/commit/5d7a4ea39bea48c90b63de783381ced493ba343e Gytis: can you apply to master using WildFly. I think the commands are the same, but you will need to test them. Also, you will need to rename the occurrences of JBoss EAP 6.1 with WildFly. I think it should be less specific about the actual version downloaded. Just tell the user to go get WildFly from the download page and then unzip it. This will stop it going out of date every time a new version is released.",,,,,
"I see. Now I understand the issue but not the context nor the solution, thanks. How does the participant recover and who rolls back the participant if there is no transaction.",,,,,
"Thanks Mike to take a look. The StompConnect code will be moved to wildfly-blacktie subsystem with JBTM-1568, I just wonder it is any problem to use the bridge or maybe another way to associated JTS transaction ?",,,,,
"[~gytis], [~zhfeng] mentioned that he had asked you to review: https://github.com/zhfeng/narayana/commit/b51faee71db0977898f471e806b5e88162100945 Have you had chance to do this yet?",,,,,
"Hi Amos, I think this is resolved? At least, the pull was merged? Tom",,,,,
"I notice qa and rts have printSummary set to true. Maybe do that for everything anyway? Whatever we do, we should be consistent though.",,,,,
Did we upgrade the surefire version recently?,,,,,
"I don't especially like the additional text either, but my detective skills have shown this is the reason it does it like this now: http://jira.codehaus.org/browse/SUREFIRE-968 Seems to make sense in the context of what they are trying to achieve, maybe we can raise an enhancement over on their Jira to make this only take affect when parallel is not false?",,,,,
Seems like a few things broke or changed behaviour due to 1875. Can we have a better vetting process in future to either prevent these things creeping in or at least document them such that they don't come as a surprise?,,,,,
Is this still likely for tomorrow?,,,,,
"[~paul.robinson] I think this is resolved? At least, I managed to debug the XTS issue we were having so I presume it is?",,,,,
"Gytis, I've had a look at this issue and updated the description with what should now work. Tom and I have tried it out. It's going to be quite time-consuming, and I still have a few M5 issues left to do. Can you take a look at this please. Re-assign it back if you don't think you will have time to do it.",,,,,
"Thanks Ondra, that looks like what I was missing. Mike is there any chance we can back port this into our community docs please?",,,,,
The definitive documentation for CLI subsystems are in the XSDs (docs/schema/jboss-as-txn_<version>.xsd). Rather than duplicate this documentation and risk it diverging my preference is to simply point the community docs at this file. Does anyone have any objections with this approach?,,,,,
Is this issues resolved now? /cc [~paul.robinson],,,,,
We should make sure we are using the PRODUCT variable throughout. We should also add variables for the target app server (IMO). This will allow us to use Narayana and WildFly for the community docs and JBossTS and JBoss AS in the product docs. Does this last point make sense?,,,,,
"I've read through the XTS docs. I've applied the minor changes (mostly typos) here: https://github.com/jbosstm/documentation/commit/238a06aa9e50ff03144c7f542c08f1b36a9e6b93. Gytis, Can you apply this to the 4.17 branch please? I also have some ideas about how to layout the docs for the new feature-work done in Narayana 5. I will discuss this with Gytis when we meet to discuss the XTS docs.",,,,,
JIRA is not the appropriate place to ask this question. Please can you raise it via the forums at http://www.jboss.org/ejb3,,,,,
"Can you add something to the documentation (the section around application server integration)? If you want, send me text and I'll put it in place.",,,,,
http://www.nabble.com/Spring---JBossTS-integration-t3901668.html You might want to mark this as Started ;-)?,,,,,
For some reason I don't spot the attachment? It does seem a little extreme but could the level be dropped?,,,,,
I am wondering about whether the reaper could process the XAResources asynchronously but process the afterCompletion from the application thread. It might help the JPA use case?,,,,,
I think that if we are allowing defaults for all values (good idea) then it should be possible for someone to deploy a transactional application without a property file. Maybe give a warning or output in Info?,,,,,
"Hi Mark, The issue is that jts is not a strict superset of jta. To be able to provide a single binary containing both JTS and JTA, you therefore need a properties file. Otherwise you have to decide the java hardcoded defaults at compile time, which means using code templates in the jta module compile. We could look at only requiring the properties file once you get to JTA or greater level of the framework? What do you think? Tom",,,,,
Or if there's no property file default to JTA (or JTS)?,,,,,
"Would the intention also be to no longer ship a default jbossts-properties.xml file in the jars, and to no longer be able to change the default name of the config file in the manifest.mf?",,,,,
What values are in the default properties file these days?,,,,,
"I think your idea of requiring it for JTA or JTS is a good start. Beyond that I wonder if we could infer these default values (e.g., JTA implementation) by what's in your class path? Maybe a separate JIRA?",,,,,
"The original Android code should still be in my Android branch on svn. The vert.x code is https://github.com/nmcl/mod-stm Try removing the property file? Note, this is 5.0.0.Final of TS.",,,,,
Is this something that needs to be meaningful in a distributed environment? What about a heterogeneous environment?,,,,,
"Hi Jesper, it would be great if you could provide a couple of details on the intended usage of the request, please?",,,,,
"I added a forum reference for this which I found. I am extrapolating a little, but is the issue related to calling hashCode in JTS afterCompletion in a subordinate node and are there other scenarios you have found it to be volatile?",,,,,
"From Jesper on the forum: {quote} JBTM-2216 is needed for cases where the Transaction instance is currently used as a key in a Map<Transaction, ?>, and the map is cleaned up in a Synchronization:afterCompletion() implementation. The map is static in order to coordinate across the JVM. Example usage (constructor) this.tx = tx; this.key = TxSPI.getIdentifier(tx); txMap.put(key, this); Example usage (afterCompletion) txMap.remove(key); {quote}",,,,,
"Hi Lami, Would you be interested in contributing a pull request for this enhancement? If so, please can you sign the CLA over here: https://cla.jboss.org/index.seam (the project is JBoss Transactions) The raise a pull request against either 4.17 or master over here: https://github.com/jbosstm/narayana/pulls Many thanks, Tom",,,,,
[~tomjenkinson] Not fully sure if our discussion at https://issues.jboss.org/browse/JBEAP-610?focusedCommentId=13147405#comment-13147405 is directly connected to this issue but you previous comments seem to me so. What I remember by [~hhovsepy]'s investigation it seemed that JTS works with 2pc for propagated transactions at any time (meaning even with one resource enlisted). Later on that was found that we have (?) some trouble in test and 1pc is used. Your reference of https://c.na7.visual.force.com/apex/Case_View?sbstr=01560781 seems to me not related as it's rather caused by the fact discussing at https://issues.jboss.org/browse/JBEAP-225 and https://issues.jboss.org/browse/WFLY-4608 which is based on issue in container. _plus as action item from f2f I would say that what you mentions in your first comment is not so. if we are not wrong in our settings then jts and jboss remoting run 1pc_,,,,,
"Hi, The QS is merged is this ""resolved""? Thanks, Tom",,,,,
Should I remove the fix version number as I don't believe this is work that is currently scheduled?,,,,,
"Would be *really* good if you posted about this on the forums too. Blog is great, but it's more appropriate for the results rather than a ""what do you guys think of this?"" type discussions. Please ENGAGE the community. Can't say that enough. We've spoken about this in the past several times.",,,,,
"Huh? Assume I can't view the Bugzilla, which may go part way to explaining my confusion ;-) Is this a race condition between recovery and application? If so it should be taken care of already within the transaction code.",,,,,
"Hi [~zhfeng], Does your current pull request enable the recovery manager? If not we should make sure you have done that as a top priority before closing this issue. Thanks, Tom",,,,,
"Hi [~tomjenkinson], In the narayana-jta-osgi bundle, I just use the configuration from ArjunaJTA/narayana-jta/src/main/resources/jbossts-properties.xml I think it enables the recovery manager and does it need to add the additional entry ? Amos",,,,,
As a start on this task I have enabled the Oracle® JRockit Flight Recorder for a subset of the performance tests in the perf CI job (http://172.17.131.2/job/narayana-performance/). Flight data is stored in the maven build directory (target/test-classes/*.jfr) and can be read using the jmc tool available in the standard JDK (edition 7u40 and above). What is the best way to evaluate other options given that there are many alternatives (and trying out each one involves engineering work): * JDK Collections (much of our code hasn't been updated to take advantage of newer releases (Jesper has been looking into this); * Goldman Sachs Collections; * Google Collections (Guava); * javolution; * Highly Scalable Java; * ... Tests with flight data currently include: Core: com.hp.mwtests.ts.arjuna.performance.Performance1 com.hp.mwtests.ts.arjuna.performance.Performance2 com.hp.mwtests.ts.arjuna.performance.Performance3 com.hp.mwtests.ts.arjuna.performance.Performance4 JTA: com.arjuna.ats.jta.xa.performance.OnePhase2PCPerformanceDefaultUnitTest com.arjuna.ats.jta.xa.performance.OnePhase2PCPerformanceVolatileUnitTest com.arjuna.ats.jta.xa.performance.OnePhasePerformanceDefaultUnitTest com.arjuna.ats.jta.xa.performance.OnePhasePerformanceVolatileUnitTest JTS com.hp.mwtests.ts.jts.local.synchronizations.Performance com.hp.mwtests.ts.jts.orbspecific.local.performance.Performance1 com.hp.mwtests.ts.jts.orbspecific.local.performance.Performance2 com.hp.mwtests.ts.jts.orbspecific.local.performance.Performance3,,,,,
"Have we seen this behaviour elsewhere in the past? I don't recall it. A change in Oracle? Or just lucky for us so far not to have seen it? As to changing the default, we can't do that until the EAP 7 timeframe even if we wanted to. Plus, we'd better be able to show that this has no impact on performance, reliability etc. in environments where the RM doesn't exhibit this behaviour. Otherwise may be best to err on the side of caution and perhaps catch the error in recovery and swap in the alternate behaviour for the next sweep.",,,,,
I think its that the EAP test suite now tests this and didn't before. It does sort of make sense that the user to commit has to have permissions on those tables. Maybe we could say the recovery user needs permissions on all the tables? but then we would need some additional config to indicate a recovery user. I will double check with Ondra that its not a regression.,,,,,
What's the procedure for ensuring our artifacts make it into maven central? How are you determining our missing dependencies?,,,,,
"Well, the missing dependency bit I qualify simply based on importing ""org.jboss.narayana.jta:narayana-jta""; if this has classes that call out into jboss-transaction-spi and that's not a transitive dependency of narayana-jta, this is missing, correct? Unless you have some mechanism in place where some code paths have optional dependencies? So: *if* my issue above is valid and jboss-transaction-spi should be a transitive, runtime (or compile-time) dependency of narayana-jta, I'd suggest we add it as Step 1. And regarding Maven Central: again *if* this issue is valid, then any dependencies of a project in Central must also be in Central, as this remote repo is intended to be a complete repository. That's according to Sonatype rules and, if I'm remembering correctly, should be enforced by our Nexus installation when we go to promote/release builds.",,,,,
So my guess is that we need to add the dependency to ArjunaJTA/narayana-jta/pom.xml - what is the easiest way to test that? I ran tattletale over narayana-jta and it reports transitive dependencies on other stuff as well (org.hornetq.core and org.jfree). Does that imply we need to add explicit dependencies on those too?,,,,,
"Just trying to work out, what were you doing to cause the issue? For example the ArjunaJTA/maven qs doesn't exhibit this behaviour after I fixed it to have the correct runtime dependencies. Some of the quickstarts do import the SPI correctly as they must need to use this behaviour: [tom@dhcppc1 quickstart](JBTM-2182) (15:40:29) $ grepinpom transaction-spi ./jca-and-tomcat/pom.xml ./jta-and-hibernate/pom.xml ./jca-and-hibernate/pom.xml It looks like ""provided"" scope dependencies of constituent modules have not been included in shaded poms. Some of this goes away if we start to recommend users to use the raw modules rather than the uber jars created by the shade plugin as then the poms are self documenting (like in WildFly). At the moment it is effectively assumed that you would know which jars to include if you use the uber jars as the Jars do not document the requirement. The disadvantage of the none-uber jar is only for JTS as you would be required to provide a configuration file to enable JTS, at the moment it is selected by the jar. Unfortunately I can't get a shaded pom to include provided scope at all, I could make it runtime but then it would still be dependent on the Jars being available which for some situations shouldn't be required. Will have a think...",,,,,
"For clarity in future if others come to this issue, can you please describe what problem you've seen and hence why you've submitted a patch. ""fails to bootstrap properly"" isn't sufficient. Thanks.",,,,,
"Hi Chris, Many thanks for your interest in Narayana. Normally for something like this it is best to start with a discussion on our forums over here: https://community.jboss.org/en/jbosstm. That said, please can you add a little more detail into the description as to the nature of the bug. We do already function in Java SE and also complex classloader hierarchies so this may be a corner case which we would be happy to work with you to address. I am not familiar with OneJar, is it a maven plugin that will put all the dependency jar classes into the same Jar as the application jar? The main problem with your report as it stands is that we don't have a well defined reason for _why_ the change needs to be made, if you can express the motivation for the change in more general terms then we can get it merged. As you say, the fix looks like it should work in our currently supported options so it shouldn't be a problem to get it merged once we have more context to backup the need to merge it. Once we understand the problem better, and we proceed with your approach, please can you: 1. Sign the CLA over here: https://cla.jboss.org/ (project is JBoss Transactions) 2. Fork: https://github.com/jbosstm/narayana 3. Raise a pull request on the main repo with your fix in. It should be easier to review inline, plus it will get CI run on it. Many thanks for the contribution! Tom",,,,,
Presumably you mean what we've discussed in the past: having the ability to bypass the SOAP layers and go directly to the underlying Arjuna classes which they wrap?,,,,,
"What does this have to do with REST transactions? If it's local-only, then distribution over REST is not an option.",,,,,
"Hi Jesper, Thanks for creating the separate issues! Can you now share the relative performance benefit of the enhancement please, same for JBTM-2209, JBTM-2207, JBTM-2208 and JBTM-2206? Thanks! Tom",,,,,
I don't think we can remove the *Mutex() methods from StateManager as these are part of the public API so people that inherit from that class would no longer have access to them (as you saw in the tests you had to modify). Please can you provide a few more details on what the performance win was with removing the Reentrant lock to help evaluate the benefit vs the drawback of the API change?,,,,,
"Maybe delay creation of lock until first use? Might help the performance issue, whatever that is.",,,,,
"Hold on ... doesn't this changed the public API of StateManager and LockManager? Whilst the latter is a superset of the previous API, the former isn't and potentially breaks other classes from users that may inherit from StateManager. Did we deprecate as discussed last July? Did we determine what the cost/benefit is of doing this?",,,,,
"I don't think we should change ArjunaCore/arjuna/classes/com/arjuna/ats/arjuna/coordinator/CheckedAction.java as it is in the public API so unless it has considerable performance win the cost of update apps to use the new API is probably not justified. As to the rest of the changes, can you give us a brief indication of the performance benefit of this particular change?",,,,,
"Mike, using our performance toolkit please can you provide some details on here about the performance improvement that we see with the commits applied? I am trying to make a decision on whether its worth having to inconvenience users by deprecating the checked action API and replacing it with the updated one.",,,,,
So no perceivable difference at all?,,,,,
I assume the plan is to leave things alone if there is no significant difference? http://www.phrases.org.uk/meanings/if-it-aint-broke-dont-fix-it.html,,,,,
Can you include a link to the forum posting here for future reference?,,,,,
"Hi Jesper, Please can you add a few more details to the Jira on the reasons for the change? Tom",,,,,
"Thanks, but that's about as much use to me as a chocolate fireguard! ;) Or giving me a scalar number when I need a vector. What was the test used? How many iterations? We could do this ourselves of course, but it'd be so much simpler if you've already done that work :-) And yes, I see the test code you added, but I was looking for some test that worked in situ with the Stack usage within Narayana.",,,,,
"Great work on the fix and the benchmark, I agree it looks like it is worth merging. Mike, may I ask you to do the honours please as it is your PR now?",,,,,
"Granted I haven't updated my local copy for a few weeks, but these warnings seemed to come all of a sudden and a lot of them to boot. Was this expected?",,,,,
So all of these warnings have been there for 7 months?!,,,,,
"The reason its not been detected is because most of our builds are done in the cloud or (certainly for myself) an IDE. If you think its an issue, maybe we should get the build to fail on warning? http://jira.codehaus.org/browse/MCOMPILER-120 is available, so its just a case of enabling -Werror.",,,,,
"No, failing on warn is probably not a good idea. I'm surprised that I didn't see it earlier, since I built the source quite a bit only a few weeks ago. I'm also surprised no one else caught it if it's been around that long. Do we regularly check the build logs? Even building in the cloud or an IDE should generate the same warnings (e.g., in Eclipse).",,,,,
I think this should be 5.next version?,,,,,
That's what me and Mike where not sure about yesterday. So do I simply put all the stuff to 5.next which I'm working on? Or do I work on 5.later and then we move them to 5.next during the planning?,,,,,
"Forum discussion? Could be around, I just can't find it.",,,,,
Can you point me at the forum posting where this was discussed? Then I can take my comments there rather than in JIRA.,,,,,
"As mentioned on the call, we need to be mindful of when we introduce this new interface method as it will require implementations to add the new method when they wish to upgrade. We could add it to a new interface. As there are various options here Mike we should create a design discussion and mention it to various teams. Can you create the discussion and flag it to Jesper (and Andy) to make sure known XARW impls are aware of the requirements (Andy obviously knows but he might want to contribute if Jesper has any observations.",,,,,
"Hi Jesper, Please can you give me some ideas of what this for? Is it the IJ tracer? I have no problem with adding it, please just provide some context as there could be more I can give you. Thanks, Tom",,,,,
"Hi Jesper, Is the attached PR what you were thinking? Thanks, Tom",,,,,
"Hi Mark, All the tests pass with that, I am happy to merge it if you like? Tom",,,,,
"Hi Tom, Mike, What is the planned fixed version of this task? Is there already a support of shutdown(timeout) in Narayana? I am asking as we have RFE https://issues.jboss.org/browse/EAP7-86 resolved and ready for QA. Thanks, Hayk.",,,,,
One of the reasons we haven't done this to date is that it's not standards compliant. Why isn't the ordering that JTA allowed in the interposed option sufficient?,,,,,
"OK, but this is not compliant with the standards and therefore if some other transaction engine is used it will break. The reason ordering of resources and synchronisations isn't supported in the standards is because it becomes very hard to manage global ordering in a heterogenous environment. Are we really happy to add something which basically ties IronJacamar and Narayana together? I'm no so sure. While it's nice to add something like resource ordering, as we do with AbstractRecords, it should be done cautiously, in situations where no other option is possible, or as an optimisation, i.e., so without it the system still works, but may be slower, less efficient etc.",,,,,
BTW what did these scripts do in the old days? Did they add the jacorb jar explicitly?,,,,,
"I should also mention, there is something strange that happens with Oracle when the patch is applied (I checked it affects BTM too). You can replicate the issue with the following raw XA and SQL code: {code} final OracleXADataSource xaDataSource1 = new OracleXADataSource(); ((OracleXADataSource) xaDataSource1).setNetworkProtocol(""tcp""); ((OracleXADataSource) xaDataSource1).setServerName(DB_HOST); ((OracleXADataSource) xaDataSource1).setPortNumber(1521); ((OracleXADataSource) xaDataSource1).setDatabaseName(DB_SID); ((OracleXADataSource) xaDataSource1).setDriverType(""thin""); ((OracleXADataSource) xaDataSource1).setUser(DB_USER1); ((OracleXADataSource) xaDataSource1).setPassword(DB_USER1); final OracleXADataSource xaDataSource2 = new OracleXADataSource(); ((OracleXADataSource) xaDataSource2).setNetworkProtocol(""tcp""); ((OracleXADataSource) xaDataSource2).setServerName(DB_HOST); ((OracleXADataSource) xaDataSource2).setPortNumber(1521); ((OracleXADataSource) xaDataSource2).setDatabaseName(DB_SID); ((OracleXADataSource) xaDataSource2).setDriverType(""thin""); ((OracleXADataSource) xaDataSource2).setUser(DB_USER2); ((OracleXADataSource) xaDataSource2).setPassword(DB_USER2); XAConnection xaConnection1 = xaDataSource1.getXAConnection(); XAResource xaResource1 = new IsSameRMOverrideXAResource( xaConnection1.getXAResource()); Connection connection1 = xaConnection1.getConnection(); XAConnection xaConnection2 = xaDataSource2.getXAConnection(); Uid gtrid = new Uid(); XidImple xid1 = new XidImple(gtrid, true, 1); xaResource1.start(xid1, XAResource.TMNOFLAGS); PreparedStatement preparedStatement1 = connection1 .prepareStatement(""INSERT INTO jta_test (some_string) VALUES ('test')""); preparedStatement1.execute(); System.out.println(xaResource1 + "" sql for "" + xaConnection1); XAResource xaResource2 = new IsSameRMOverrideXAResource( xaConnection2.getXAResource()); Connection connection2 = xaConnection2.getConnection(); XidImple xid2 = new XidImple(gtrid, true, 1); xaResource2.start(xid2, XAResource.TMNOFLAGS); PreparedStatement preparedStatement2 = connection2 .prepareStatement(""INSERT INTO jta_test (some_string) VALUES ('test')""); System.out.println(xaResource2 + "" sql for "" + xaConnection2); preparedStatement2.execute(); xaResource1.end(xid1, XAResource.TMSUCCESS); int prepare1 = xaResource1.prepare(xid1); xaResource2.end(xid2, XAResource.TMSUCCESS); int prepare2 = xaResource2.prepare(xid2); if (prepare1 != XAResource.XA_RDONLY) xaResource1.rollback(xid1); if (prepare2 != XAResource.XA_RDONLY) xaResource2.rollback(xid2); {code} That first prepare returns XAResource.XA_RDONLY. If you alter the code to use a different gtrid for each branch the resource manager returns XA_OK as expected (but obviously that is not what happens when the TM is involved as the gtrid is fixed for the TX). It appears that internally Oracle may be optimizing the SQL into the second prepare as when I reordered the prepare calls xid2 instead returned XA_RDONLY. It might be a setting on our database I am not sure. Either way you should verify that the app is performing the updates that you expect.",,,,,
"Tom, great write up. I suggest changing this issue from a bug to something else (feature request?)",,,,,
"JTS participant records are not in-lined with the transaction log so they appear in a separate part of the log store. The tooling only shows participants for JTA records which do have their participants inlined. Ondrej, is the Fix version field (6.0.0) ok? I just noticed that Gytis is down as the assignee so I will let him update that field.",,,,,
"Wouldn't it have been easier/better/less invasive to have hidden this within a call to something like getCheckedActionFactory()? _checkedAction = _checkedActionFactory.getCheckedAction(get_uid(), type()); + _checkedAction = allowCheckedActionFactoryToBeOverriden ? arjPropertyManager + .getCoordinatorEnvironmentBean().getCheckedActionFactory() + .getCheckedAction(get_uid(), type()) + : defaultCheckedActionFactory.getCheckedAction(get_uid(), + type());",,,,,
"Suggestimate suggests that this is similar to JBTM-2225, which appears to be true, no?",,,,,
[~mmusgrov]: would this be enough to get rid of JNDI for us entirely then?,,,,,
"I can look into providing an implementation using this approach. Our docs do say ""This is not recommended, but provides a fallback for environments where use of JNDI is not feasible"" but I do not know why it's not recommended - I will find out. But given that we have ceylon.transaction fully working with the JNDI approach why do we need to jettison its use?",,,,,
So this was closed and then fixed?,,,,,
"Two questions: 1) is this being driven by any customer/community request? 2) presumably the javadocs generated will always depend upon the build you perform, e.g., JTS doesn't get covered if I'm only building core?",,,,,
"Here are the updated name server and transaction service images: https://github.com/Gytis/narayana-docker/tree/master/jts I've added extra configurations and a couple of unit tests. And here is the quickstart: https://github.com/Gytis/quickstart/tree/master-JBTM-2296/jts-docker All the code is the same. However, readme was extended to explain how use different types of object stores. Any ideas?",,,,,
"[~tomjenkinson], you had a go with it some time ago. Do you think it's usable enough to be merged into our dockerfiles repo?",,,,,
"[~marklittle], just wanted to confirm, if by ""Project Atomic docker image"" you meant Atomic App [1]? [1] http://www.projectatomic.io/docs/atomicapp/",,,,,
"It looks like we don't need it as we has removed the TAO dependency in JBTM-1665 and used the http rest methods to access the TM [~tomjenkinson], Does it make sense ?",,,,,
Agreed. Maybe create a separate JIRA for the tooling?,,,,,
"Yeah, I haven't upgraded the logging for the component. The only thing I can think is that maybe the default used to be WARN or something? From looking at the log statements there looks to be three statements, its the way the log messages are formatted that is causing each of the statements to bridge two lines. The logging format looks to be the format generated by JDK logging rather than log4j so I guess this is in an IDE? {code} 2014-12-18 16:30:49,755 [main] INFO (ats.arjuna :88 ) - ARJUNA012163: Starting service com.arjuna.ats.arjuna.recovery.ActionStatusService on port 51214 2014-12-18 16:30:49,765 [main] INFO (ats.arjuna :327 ) - ARJUNA012337: TransactionStatusManagerItem host: 127.0.0.1 port: 51214 2014-12-18 16:30:49,765 [main] INFO (ats.arjuna :138 ) - ARJUNA012170: TransactionStatusManager started on port 51214 and host 127.0.0.1 with service com.arjuna.ats.arjuna.recovery.ActionStatusService {code} I am happy for those statements to move down to debug but the reason they are info is the default option seems to be to choose a random port so it might be the case then that people would all enable debug just to get at that. I can see why with multiple processes on the same machine why electing a port dynamically has some advantages but I know that WFLY at least configure a default of 4713. (4712 for recovery port). Why don't we use those defaults and only then log the statement at INFO if the user changes the port to 0?",,,,,
Does that address the same use case though? If not then we should re-examine what we're doing.,,,,,
How is this different to the current class that allows thread-to-transaction association and disassociation?,,,,,
"Happy to go with either, I wonder if Container could be confused with JEE container though. Maybe Cloud? I had a quick look at other projects and Forge has Docker and LiveOak seemed to use Cloud. I am happy with Docker though even with the potential overloading.",,,,,
Would we need a variant of WFLY-1119 (Assign an unique NodeID automatically) to avoid conflicts (ie would different images share the same JDBC store). Also it is possible to point the tooling (ObjStoreBrowser) at a filesystem to manage the logs although it is unsupported (normally it is done via a JMX browser connected to the TM process). Do we need similar functionality for accessing the JDBC store directly?,,,,,
"Hi Toby, we can't change it to look for jbossts-properties.xml solely, the reason we can't remove the check for arjuna-properties.xml is due to backwards compatibility. The work in JBTM-482 was about changing the file name inside JBoss really which was completed. As such, I see this as an enhancement. Would allowing a system property to override the default name of the file work for you?",,,,,
We should try to get the best JDBC results we can so should try to use a database that is either on the same machine ideally. Does haverstraw host a postgres?,,,,,
"EDIT: The first link will need to be viewed using: https://drive.draw.io/?#G0B9c6Ahw-picmQklPZXp5M19nalk as the text does not seem to be visible on the Google Docs preview --------------------- Gytis has a draft, I have shared it publicly but its still very much in development: https://drive.google.com/file/d/0B9c6Ahw-picmQklPZXp5M19nalk/view?usp=sharing For comparison, this is the existing version: http://narayana.io/images/narayana-architecture-diagram.jpg I think we need to align the cosmetics with other JBoss.org projects. Are isometric boxes still the most graphically clear?",,,,,
I think a link to github is probably OK. Maybe do it by tag?,,,,,
Is it OK to raise this one now that 2377 is merged thanks?,,,,,
"Great, please can you let me know when the PR is merged so I can start the 5.1.1 release?",,,,,
"I am surprised you think its an anomaly. As an example, when you turn volatile store on our performance is something much more than a 15 fold improvement iirc? Some suggestions: 1. Are you using HQ store (can you use it in this config)? 2. Have you tried enabling the volatile store? In terms of notx vs emptytx I expect that is all down to the creation of the TX endpoints. You could profile the server to get more details there. I imagine your participants are no-ops so in the no tx case you have 2 no-op calls vs the empty tx case where you have 3 no-ops (I will class commit() here as a no-op as I assume it really is very little) and 1 op (the creation of the tx endpoints). Seems reasonable to me. In the emptytx case, can you drop the commit calls (without it falling over) to see the cost of the commit vs the create?",,,,,
Looks like a duplicate of JBTM-2216 to me. https://github.com/jbosstm/narayana/blame/master/ArjunaJTA/jta/classes/com/arjuna/ats/internal/jta/recovery/arjunacore/XARecoveryModule.java Its fixed in WFLY master version (was fixed in Narayana 5.0.4 which should be in WFLY since 9.Beta1).,,,,,
"[~tomjenkinson], do we have analytics id etc.?",,,,,
"I see the test passing now - thanks for the quick update :) re the LockException misconception I had, I now understand why throwing an exception is wrong here, though I wonder if it is worth trace logging something to help clarify if a TX is rolling back due to OCC conflict?",,,,,
"Thanks Tom, Which component would that be. Tom",,,,,
"Yesterday I pushed the fix that does not upgrade arquillian so we are good to go on our CI builds. Do you think the jira still warrants the blocker status? Mike -- Michael Musgrove Red Hat UK Ltd, Transactions Team e: mmusgrov@redhat.com t: +44 191 243 0870 Registered in England and Wales under Company Registration No. 03798903 Directors: Michael Cunningham (US), Charles Peters (US), Matt Parson (US), Michael O'Neill(Ireland)",,,,,
I am not sure how easy this will be but is it possible to leave it as a system property where we can enable it? e.g. -DenableDebugger,,,,,
Is there anything in Narayana that requires Java8 though? If not then why not still allow that at build time?,,,,,
"That's WildFly and I do understand why they're moving to 8. However, if someone wants to build a component project using 7 then why wouldn't we allow that within that project until/unless we add features only available in 8?",,,,,
Do you know why these only seemed to start failing when we upgraded to JDK8?,,,,,
"Hi Mike, Am I right in thinking that this should be fixed, but we still have JBTM-2454? If so it is worth closing this one. Thanks, Tom",,,,,
"I asked [~adinn] to provide an opinion about whether it could be the annotation rather than the agent loading functionality that is the root cause of the problem and he suspects that it is most likely a bug in the dynamic agent loading behaviour in the J9 compiler. He also gave a good analysis of the issue which I am including here: {quote} I downloaded IBM's Java 7 SDK and tried to use it to build Byteman. That's enough to thoroughly test the use of the agent. The tests on the Byteman agent maven module are configured to install the agent from the command line using the -javaagent option (I do that rather than use the BMUnitRunner to auto-load because I don't want failures in BMUnit to stop the agent jar being built). These tests all worked ok. So, the IBM JDK does support all the functionality of the Byteman agent when you load it from the command line. The maven tests in the BMUnit maven module rely the BMUnitRunner annotation to auto-install the agent into an already running test JVM and this is what failed. The error output is attached. As you can see from the first exception trace the IBM JVM does implement dynamic loading -- the Attach operation is fielded and J9 tries to install the agent by executing com.ibm.tools.attach.javaSE.Attachment.loadAgentLibrary If you look at the cause of the exception you can see that this eventually calls into org.jboss.byteman.agent.Main.premain which is the Byteman entry point. This tries to register its ClassFileTransformer (InstrumentationImpl.addTransformer) and at this point J9 blows up. It is objecting to the agent's request for the ClassFileTransformer to be installed as a 'retransformable' transformer. That means it wants to be able to handle retransformations of existing classes as well as being given a chance to modify newly loaded classes. This seems a tad odd because when the Byteman agent is loaded on the command line it also asks its ClassFileTransformer to be installed as a retransformable transformer. So, the refusal by J9 must be some sort of policy decision on its part. I suspect that this may be a performance hack -- J9 may be willing to not perform certain optimizations in order to allow for retransformers if you install them from the get go but otherwise may decide to switch on optimizations that mean subsequent use of retransformers won't work. Whatever the reason IBM have done this you are snookered until you can get them to remove this restriction. n.b. it is a legitimate (i.e. JVMTI agent spec-compliant) behaviour but it's not exactly very useful. I will make eqnuiries to see if I can talk to someone in IBM and get this removed or, at least, find a way to relax it but I am not sure I will have any traction. I think there is only one workaround which will fix this if you want to use BMUnit on both OpenJDK/Oracle and IBM. You will need to switch to loading the agent from the command line (whatever JVM you are using). To do this you need to: i) install the agent on the command line of the test JVM by configuring java command line argument -javaagent:/path/to/byteman.jar=listener:true ii) stop BMUnit from loading the agent by adding adding the property setting -Dorg.jboss.byteman.contrib.bmunit.agent.inhibit n.b. you will need to build the path to the byteman jar by referencing the relevant dependency in your maven repo dir. you should be able to do that using by substituting maven property values (repo dir + byteman dependency version) into the path n.b. if you don't do the load yourself then you may want to set some other -javaagent options and/or Byteman system properties. The auto load will do the equivalent of adding boot:/path/to/byteman.jar to the -javaagent line and adding -Dorg.jboss.byteman.allow.config.update as a system property setting. The former allows you to inject into JDK runtime classes. The latter allows BMUnit to pay heed to your any options specified using a BMUnitConfig annotation on your test class. regards, Andrew Dinn {quote}",,,,,
Is this done?,,,,,
What was the resolution?,,,,,
Can this be closed?,,,,,
It was added as a warn during rollback. I can certainly make it a debug option but the request came in from [~stephen.fikes] at the Narayana F2F that it would be useful in timeout situations. If we go for debug only then it will lose some of its power because the user would need to recreate the timeout which might be difficult. I could add an option on https://github.com/jbosstm/narayana/blob/master/ArjunaCore/arjuna/classes/com/arjuna/ats/arjuna/common/CoordinatorEnvironmentBean.java so they user can choose to disable the enhancement (or maybe allow them to select a log level for the message)?,,,,,
"a ""Tricks"" section to the README.md if the SVG file gets too big. Brendan is working on a Python version of FlameGraph https://github.com/brendangregg/FlameGraph/tree/master/dev which has search support: Search -> com/arjuna -> Purple nodes",,,,,
"Hi [~gytis], this has been Coding in Progress for a while. Is it worth marking ""Work Stopped"" as I don't think you are currently coding on this one?",,,,,
Are we not planning to make the release completely automatic and incorporating it into our CI?,,,,,
"Hi Hayk, Would you have chance to work on this at all? You have marked it as a blocker so trying to work out the priority as you didn't mark a fix version. Thanks, Tom",,,,,
"The failures related to the upgrading to the activemq artimes in WFLY 10. Also in the Step 5, you should run with standalone-blacktie.xml {code} copy docs/examples/configs/standalone-blacktie.xml wildfly-<version>/standalone/configurations bin/standalone.sh -c standalone-blacktie.xml {code} I'm sorry that I can not find in the QS to say use WFLY 9 but I will update the README.md to say it should integrate with the master from WFLY. can you show me where you find the information to run with WFLY 9 ?",,,,,
"Thanks Amos - what is missing to make it work with WildFly 10, please?",,,,,
What about JTAX BaseTransaction.java?,,,,,
"Hmm, that will be the JTS version, eh? Ok, I'll patch that too.",,,,,
"Daniel, would you please clarify the scope of the quanitfiers 'some' and 'all' in your issue description? i.e. in which documents have you noticed the format problem? which other documents do you suspect are affected?",,,,,
"Hi Andrew, As I'm planning on going through the docs anyway, I'd be happy to take this JIRA and update the doc if you like? /Daniel",,,,,
"I meant https://github.com/jbosstm/performance/tree/master/comparison, but I'm not sure it's going to work. Is it possible to use JMH to test Arquillian tests? Or applications in WildFly deployed manually?",,,,,
Did you put back a commit for the unit tests for now?,,,,,
Any more details on this?,,,,,
"I did some debug with the CrashRecovery2 Run with the following command {code} ./build.sh -f ArjunaJTA/jta/pom.xml clean test -Dtest=CrashRecovery2 -Dorg.jboss.byteman.debug -Dorg.jboss.byteman.verbose -PcodeCoverage {code} check the output of the test and it looks like the rule does not be triggered as it can not find the local binding var ""$this"" The fail2pc rule is {code} RULE Fail 2PC CLASS com.arjuna.ats.arjuna.coordinator.BasicAction METHOD phase2Commit AT ENTRY BIND NOTHING IF readCounter(""phase2commit"") == 0 DO debug(""Called""), incrementCounter(""phase2commit""); com.arjuna.ats.arjuna.coordinator.ActionManager.manager().remove($this.get_uid()); RETURN ENDRULE {code} The failure is {code} start:4 triggerPos:0 end:535 (I add this debug message in agent/src/main/java/org/jboss/byteman/agent/adapter/RuleCheckMethodAdapter.java) RuleCheckMethodAdapter.checkBindings : invalid local variable binding $this checking method phase2Commit(Z)V {code} if we run without the jacoco, the start and end is {code} start:0 triggerPos:0 end:327 {code} [~adinn] how do you think about this ?",,,,,
"Hi Amos, thanks for reporting this. I don't know why you are seeing that error. It's very odd because $this is the only local variable reference that we can identify when there is no local variable table. Could you try changing the rule to use $0 instead of $this and see if that makes it work.",,,,,
"Thanks Adinn, I met this error when running the codeCoverage with the jacoco. The $0 works. So it looks like the issue is related to the script but not the jacoco ?",,,,,
"Doh! I see Amos is way ahead of me here (nice work, Amos :-) The trace statement Amos inserted shows that the local variable checking code has found an entry in the local var table for $this but one that starts at bytecode offset 4 and ends at offset 535. The injection code is trying to inject the rule at offset 0 i.e. at entry to the code. This is after transformation by Jacoco. With no transformation the local var this is found starting at offset 0. I have not yet looked at the Jacoco code but it seems pretty obvious what is happening. When Jacoco inserts profiling instructions into the method it updates the start and end offsets for entries in the local variable table to take account of the new code. One of those profiling instruction sequences will be injected at the start of the method and Jacoco appears to be shifting the local var start offset for this so that it comes into scope after the profiling code rather than at bytecode 0. No doubt it is also shifting the start position for method parameter entries. This is at best unhelpful; actually, I think it is an error because this and the parameters are /always/ in scope from the start of the method even if code is inserted before the start. I thought that ASM fixed this as a special case. Which version of Jacoco is being used here? The latest Jacoco version uses ASM 5 which shoudl deal with this problem. Have you tried updating to a later Jacoco? If that doesn't work I'll take this up with the Jacoco developers.",,,,,
Thanks for the detailed explanation Andrew - it certainly sounds a complex issue. Do you know of any other coverage frameworks that Byteman might interoperate with today? If not we can just disable the byteman tests under coverage testing. If you do get a Jacoco issue reference please can you let us know so we can reference it here? Thanks again!,,,,,
So do I need to add those to all the quickstart poms?,,,,,
Because if so we need to do it in a profile at a guess. Unless those arguments work on an IPv6 box. Do we know which quickstarts need those? [~hhovsepy] - can you raise a PR if you have the fix on your box so we can check it works on our CI cluster too please?,,,,,
"Hi [~hhovsepy] - I thought Mike said you had tested a fix locally? If so, please can you commit it and PR it and I can amend it as necessary? Alternatively just paste in the surefire config you tested as a comment and I will try it here.",,,,,
http://albany.eng.hst.ams2.redhat.com/job/narayana-quickstarts-ipv6/ ?? I didn't even think we had dualstack machines in ams2? If so we should move the dualstack job onto ams2 cluster instead of ncl one.,,,,,
Did you need any fixes to Narayana to make it work on IPv6 because I think [~hhovsepy] is reporting they don't work for him? I think the reason they would work on IPv6+IPv4 is arq will be fine to run with its IPv4 args. I therefore don't think we can mark it as resolved because the QS are running on IPv6 with IPv4 too so that is difference to the summary+description of this issue.,,,,,
"As I understood, this task was created to add new maven profile into several quickstarts to pass IPv6 parameters (mentioned in earlier comments), right? Is it already done?",,,,,
"Yes, using 5.2.9.Final produces an example that works ... 15:43:35,988 INFO [org.jboss.weld.deployer] (MSC service thread 1-1) WFLYWELD0006: Starting Services for CDI deployment: ROOT.war 15:43:36,055 INFO [org.jboss.weld.Version] (MSC service thread 1-1) WELD-000900: 2.2.16 (SP1) 15:43:36,303 INFO [org.jboss.weld.deployer] (MSC service thread 1-3) WFLYWELD0009: Starting weld service for deployment ROOT.war 15:43:38,196 INFO [stdout] (ServerService Thread Pool -- 58) StartupBean call 15:43:38,217 INFO [stdout] (ServerService Thread Pool -- 58) MyEJB call 15:43:38,217 WARN [com.arjuna.ats.arjuna] (ServerService Thread Pool -- 58) ARJUNA012094: Commit of action id 0:ffffc0a80121:-26a9308d:567c12a6:b invoked while multiple threads active within it. 15:43:38,218 WARN [com.arjuna.ats.arjuna] (ServerService Thread Pool -- 58) ARJUNA012107: CheckedAction::check - atomic action 0:ffffc0a80121:-26a9308d:567c12a6:b commiting with 1 threads active! 15:43:38,602 INFO [javax.enterprise.resource.webcontainer.jsf.config] (ServerService Thread Pool -- 58) Initializing Mojarra 2.2.12-jbossorg-2 20150729-1131 for context '' 15:43:40,112 INFO [org.wildfly.extension.undertow] (ServerService Thread Pool -- 58) WFLYUT0021: Registered web context: / 15:43:40,151 INFO [org.jboss.as.server] (ServerService Thread Pool -- 34) WFLYSRV0010: Deployed ""ROOT.war"" (runtime-name : ""ROOT.war"") 15:43:40,264 INFO [org.jboss.as] (Controller Boot Thread) WFLYSRV0060: Http management interface listening on http://127.0.0.1:9990/management 15:43:40,266 INFO [org.jboss.as] (Controller Boot Thread) WFLYSRV0051: Admin console listening on http://127.0.0.1:9990 15:43:40,266 INFO [org.jboss.as] (Controller Boot Thread) WFLYSRV0025: WildFly Full 9.0.2.Final (WildFly Core 1.0.2.Final) started in 14595ms - Started 330 of 510 services (221 services are lazy, passive or on-demand) I won't raise a pull request because maybe there's a reason it shouldn't be 5.2.9.Final. Whoever takes this issue should provide the right fix, i.e., don't wait for me :)",,,,,
"OK, so rather than remove this and revert back to what we had for 20+ years, I've made it a trace. There may have been a reason why it was needed, e.g., debugging? Would be good for someone to link any related issues here for the future.",,,,,
[~stalep] I have no problem with doing a release with this in but I think Narayana will use the one in WFLY anyway so you could just upgrade the version of the journal in there?,,,,,
"Maybe WFLY pulls our version of Artemis transitively or something? Anyway, will merge when the PR passes - should be an hour or two.",,,,,
"[~lbarreiro] - understood. Will do the release as the PR passed. It will be tomorrow AM (UK) though. I don't think characterising this as a bug (in Narayana) is correct so changing the issue type. Also, please can you add a description? Probably just replicate your comment https://issues.jboss.org/browse/JBTM-2599?focusedCommentId=13145088&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13145088",,,,,
Is this done?,,,,,
Can we get a link to your branch here please?,,,,,
Can you ask for feedback on the forum now it seems complete.,,,,,
Is this resolved as part of the CLI work possibly? e.g. can the AS7 CLI be deployed externally?,,,,,
"Hi Mike, This issue was marked as ""Resolved, Done"" but there is no ""Fix Version"" specified. Please can you update the Jira with the version of the software where you fixed this? Also, can you then close the issue (assuming its not an in development version). Thanks, Tom",,,,,
"Ok, I have managed to modify XTS to run over JBossWS/CXF 3.1.0 but a few caveats apply I had to patch two bugs in CXF so we cannot go ahead with moving to CXF untiil JBossWS assimilates fixes for CXF-2161 and CXF-2167. I had to break XTS working on JBossWS/Native because of several incompatibilities. The most notable difference is that the AddressingProperties class and related classes reside in different packages but there are a couple of others: i) the RelatesTo field in CXF has only one entry whereas in JBoss it is an array of entries ii) when a JaxWS port is created from a W3CEndpoint JBossWS configures its request messaqe properties with a MAP containing any WSA header values derived from the endpoint. this requires the XTS code to merge any extra headers into the existing MAP. CXF stashes the endpoint WSA header values in the port and so XTS has to create a MAP containing the extra headers and hang this off the request message properties. iii) CXF does not support JAX-RPC so the JaxRPC client handlers could not be compiled (the requisite headers are missing from the CXF libraries). This means the old version of the demo has to be dropped on CXF. Ignoring the JAX-RPC issue, it ought to be possible to hide these differences behind a wrapper class which managed the underlying MAP types and handled the task of configuring a JaxWS port. However, this would mean that the build process would have to be modified to build either a JBossWS/Native compatible version or a JBoss/CXF compatible version i.e. the XTS code would for all intents and purposes become dual binary (this is why we really need a fix in JBossWS).",,,,,
"Hi Alexis, I think you might be in the wrong place, this is the transaction manager component not the JMS component? Maybe you could talk to the Artemis team? Unless I misunderstood but in which case I recommend a discussion here first: https://developer.jboss.org/en/jbosstm/content?filterID=contentstatus%5bpublished%5d~objecttype~objecttype%5bthread%5d",,,,,
"Good work Amos, I wonder if we can upgrade the SPI org.jboss.spec.javax.resource:jboss-connector-api_1.5_spec:jar:1.0.0.Final dependency to a later one that includes JTA 1.2?",,,,,
Where is the link to the PR?,,,,,
"Hi [~tomjenkinson], I was wondering on your comment https://issues.jboss.org/browse/JBTM-2733?focusedCommentId=13284121#comment-13284121 and now I found some time to go through the XA spec for it. I wasn't able to find reason behind why the recover sequence should be {{xa_recover(START), xa_commit/rb, xa_recover(END)}} and can't be e.g. like {{xa_recover(START|END), xa_commit/rb}}. Would you be so kind and elaborate a bit on this? Or can you point me to spec/article where I got information how this is expected to be used? It's quite possible that I just haven't read/searched properly. I'm just curious. Thanks in advance.",,,,,
"I have added the new JMS recovery provider to the ats integration module (the attached zipped tar file contains the tests I used to validate the fix). To enable the feature add the following property to the jta section of the jbossjta-properties.xml file: <property name=""com.arjuna.ats.jta.recovery.XAResourceRecovery.JBMESSAGING1"" value=""com.arjuna.ats.internal.jbossatx.jta.JMSProviderXAResourceRecovery;java:/DefaultJMSProvider""/> The recovery code requires a minor fix to the JBossMQ implementation (I've raised JIRA JBAS-5502 to track this). The attachment contains the config files I used to enable recovery. If you use a JBossMQ PersistenceManager with an Hsql Db then make you disable the write_delay property to ensure that data is immediately flushed out to disk. I used a MySQL Db (the relevant SQL is in the file mysql-jdbc2-service.xml (if you use this make sure you remove the default config ie hsqldb-jdbc2-service.xml). The recovery code does not work with non-durable topic subscriptions (I will raise a JIRA against JBoss Messaging to get it tested on the latest JMS implementation).",,,,,
"Do you mean simply saving them as .odt files? I tried to check one in but got the following error : svn: CHECKOUT of '/!svn/ver/15549/labs/jbosstm/trunk/ArjunaCore/docs/install_guide': 403 Forbidden (https://svn.labs.jboss.com) Am I using the wrong path or don't I have the correct permissions to commit perhaps. Thanks, Daniel",,,,,
"Hi [~tomjenkinson], during the check ups JBEAP issues I got to this issue and when applying the same test as I have for JBTM-2636 I found out that there is a branch in code where deffered exception is not added - that's when heuristic happens. Is it intentional? This kind of update fixes the issue that I refer to: https://github.com/ochaloup/narayana/commit/cb2ab4252a6c2e1106751d28103daefea42e86f6",,,,,
Sorry Ondra - I don't quite follow. Which branch does not have this commit in?,,,,,
"Ah yes, that sounds useful. Perhaps you can add a unit test to ExceptionDeferrerTests and we can look to merge it? This is the type of test to add: https://github.com/jbosstm/narayana/pull/1116/files I think you should raise a new issue though because it will be confusing to track the change against the resolved one.",,,,,
What does the error look like with your patch? What is the effect of the NPE?,,,,,
"This class was added to demonstrate how to support new log record types in the tooling. The bug is that it was included in the default list of types. What is your plan to fix this, are you going to remove it from the default list?",,,,,
"[~mmusgrov] ok, that could be my wrong in understanding the issue here. Without the header reader I got troubles to get working ExpiredAssumedCompleteScanner. But I could take it from a wrong end. In that case, this change would be superfluous and the fix should go in opposite way - removing from the default list and leaving header reader in the test package. Can you please elaborate a bit on what is the correct way of fixing it? Thanks in advance!",,,,,
I may have misunderstood something. I thought this was required to fix a JBEAP issue? Straight up reverting isn't right because the ObjStoreBrowser (in main) shouldn't depend on a test class. But we could make it so its not in the default list. [~mmusgrov] what do you think?,,,,,
"Thank you for backporting. I put 4.2.3.SP5_CP07-brew jars into EAP 4.3.0 CP06 (SOA-P 4.3.0 CP02) and tested AtomicActionExpiryScanner. Then I found that expired tx-logs were copied to ""Expired"" directory but the original files were not removed. > find data/tx-object-store ... data/tx-object-store/HashedActionStore/defaultStore/StateManager/BasicAction/TwoPhaseCoordinator/AtomicAction/#197#/7f000001_9020_4b025a1e_2f9 data/tx-object-store/HashedActionStore/defaultStore/StateManager/BasicAction/TwoPhaseCoordinator/AtomicAction/Expired/#197#/7f000001_9020_4b025a1e_2f9 ... It's hitting JBTM-418. Could you take care of JBTM-418 for 4.2.3 branches too?",,,,,
"Would this work as a general design pattern if you wanted to implement a HA recovery coordinator? 1. Use the JDBC object store. 2. Configure a recovery coordinaor (RC) on each node to recover all (*) nodes. You can only *start* one of these RC at any one time 3. Develop some ""watchdog"" process runs on every node and monitors the current RC process and if it fails, uses a group protocol to elects one of the other RC's to start 4. Rather than starting the RC on one of the nodes, start the watchdog processes and allow them to enable one of the RC's Would this work for JTS?",,,,,
"Yes, we definitely don't want to duplicate code from elsewhere. How about getting the ManagedConnectionFactory instance from JNDI, since that's what creates the WrapperDataSource in the first place?",,,,,
Or the ConnectionFactory?,,,,,
"Can you take any queries and discussion to the forums, where it's easier to track? Thanks.",,,,,
"See http://jira.jboss.com/jira/browse/JBTM-20?page=all for the backstory on this. We already downgrade this stuff from INFO to DEBUG when running integrated with the AS. The arjuna level won't be changed, so the options are to change the global rewriting of arjuna messages in AS from INFO->DEBUG to INFO->TRACE which will impact other messages too, or install a filter in log4j. Why is AS even logging at DEBUG by default? It should be INFO, at least for production releases.",,,,,
"Just a clarification: this is not about deprecating what NORMAL does, just changing the name from NORMAL to PERIODIC. Correct?",,,,,
"What happens if a module goes away between first and second passes, or during a recovery pass? Do we need blocking unregister calls for modules so that does not happen?",,,,,
"Can you please explain why the value of this timeout needs to be configured with a larger value and how this value relates to your transaction's 'size'? Also, by 'size' are you referring to the number of participants or the amount of work done by each participant? The transport timeout is only ever employed when dispatch of a WS-C/T protocol message must wait on receipt of a corresponding protocol message. For example, the WS-AT Coordinator engine responds to a prepare request by sending a PREPARE message to the participant and then waiting for a PREPARING message to be returned in response. Processing of the incoming message and dispatching the corresponding response will normally happen very quickly as it only involves a small amount of work on the part of the transaction system. The other variables in the equation are the communication transport delays and, in some cases, a certain amount of processing time added by the participant implementations (in the example above the participant's prepare method will be invoked). The participant may conceivably be delaying the response for more than 30 seconds. If so then this is likely to be due to an error in the participant.",,,,,
"I'm still not convinced that configuring this timeout is the correct thing to do. Can you explain i) which database you are using and ii) what your code is doing in the prepare call? I am assuming that this problem arises because entities created in your subordinate TX only get flushed at prepare time due to the delegation involved in bridging. The persistence manager install a Syncrhonization to flush cached SQL updates to the database. This normally runs before the 2PC is entered but with bridging the flush cannot be performed (i.e. the Synchronization cannot be executed) until the delegated prepare arrives which stalls the parent TX. One possibility might be for you to manually flush changes inside your EJB code as you make them. This should leave little or no work to do at prepare time because the DB updates will already be out on disk. Can you try this? Another option might be to do break the create operations into lots of little transactions. Do you have to do this update all in one go? Anyway leaving these questions aside for the moment, if you want to reset the timeout you can easily do so by invoking TransportTimer.setTransportTimeout(long) from your application code.",,,,,
When resolved the server manager jar should be included in the JBossTM build (and the server wrapper removed),,,,,
Can you give a use case for this? I'm not seeing any real advantage over just doing e.g. -Dcom.arjuna.ats.arjuna.xa.nodeIdentifier=foo ?,,,,,
"Jonathan, How to end-up with a ""smooth"" integration within the AS? I understand that the TM has its own configuration file when working inside some other runtime, but when runing inside the AS, can't he use the JBoss config files (like jboss-services.xml file) or similar? If not, can we at least implement the same feature set as JBoss AS has, including the property replacer that Roland was suggesting to add? Thanks for your feedback. Cheers, sacha",,,,,
"Hi Sacha Please clearly define what you are trying to achieve. So far nobody has given me a convincing, specific real world use case for this feature. As far as I can tell the existing ability to override values from the config file by specifying system properties is equivalent to value substitution, except for cases where you may want to use the same value for multiple parameters. The only such case I can think of is the IP address, for which we have a separate solution anyhow. With the exceptions of the port bindings (which will be done via SBM), recovery (which will be done via the new tx integration API) and multiple 1PC (which is an horrifically bad idea anyhow), users should not need to change values in the tx properties file. I believe this feature will benefit only a small proportion of users. I agree it's better to have consistent behaviour for the properties files, it makes for a better user experience. But that's secondary to having a product that works. Because of these factors, I consider this issue a low priority. It will get done as and when we have time, but not until e.g. crash recovery and JTS integration are finished. That's why it's still not scheduled against any particular release. Perhaps I'm missing something though. If you feel it's worth taking time out from managing the division to comment on the issue, you must feel it's important. Can you say why?",,,,,
Which svn tag are your src changes based on?,,,,,
Adjusted the ant script run-qa.xml (which schedules JBTS tests in batch under the Distributed Testing Framework) to omit all tests involving the database FirstSQL.,,,,,
"Most JTS test now run locally. Some issues still exist: no JTA test coverage, no JDBC test coverage, excessive memory usage by ant/junit, excessive buffering of output (may be related to memory usage), occasional unexplained hanging of tests on husdon only (ORB shutdown blocking?). These are relatively low priority. Pushing to next release.",,,,,
"Added getters and setter for addresses / ports to the jta and jts service mbean interfaces and implementations. Revised assorted jta/jts/core internals to remove knowledge of AS from things that don't need it - the TransactionManagerService puts the values from ServiceBindingManager (or SERVER_BIND_ADDRESS as a fallback) in to the arjuna config objects, so app server integration is transparent to the rest of the JBossTS codebase. Revised XTS AS integration to read same service bindings the AS webserver uses, making it more POJO and less JMX style integration. Whilst checking port bindings, discoved and fixed inconsistencies in various places where 4711 was stated as recovery manager port, rather than the correct 4712. Used 4713 for transaction status manager and 4714 for socketProcessId in the app server. Note that when running standalone these still use random ports - do we want to hardcode these defaults in the standalone version also?",,,,,
"Done: JBTM-1472. Can you add some more detail to the description? As it stands, my understanding of this issue is that it's a duplicate of JBTM-1472.",,,,,
"Since I'm going thru this now, I'll summaraize what I was looking for in the docs that this JIRA can hopefully address. I have a J2EE app running in JBossAS 4.2 - it can support either PostgreSQL or Oracle (I deploy a custom datasource in my own -ds.xml file) Because I am not limited to just Oracle, I want to use JDBCXARecovery (the title of this JIRA mentioned ""OracleXARecovery"" - so I mention this so we can have docs for the recoverer that uses JNDI to obtain the XADataSource). I need to know what settings I have to put in jbossjta-properties.xml to enable XA-recovery for my datasource. This documentation is more targeted to the JBossAS integration with JBossTM, since involves talking about what settings to put in the conf/jbossjts-properties.xml.",,,,,
"Jonathan, can you take this?",,,,,
FYI. I am going to mark TxManager as deprecated. See the linked task. Any reason why you didn't use links?,,,,,
"""Any reason why you didn't use links?"" Nope, no reason.",,,,,
"Please can you review this in context of JBTM-1230, I think the changes we made there might have addressed your requirements",,,,,
"Hi Tom, please let me understand something. From JBTM-1230 I understand that JDBC connections for the Object Store are now retrieved using JNDI, is this correct? If so, as I already stated already in other circumstances, this is a problem for us, since we're using JBoss TS embedded in an application which is meant to work outside a JEE environment. We would need to setup a fake JNDI repository with Spring to let the object store find JDBC connections. Do you confirm this? Or is there an alternative way to still provide connections without JNDI? If not, I personally consider this, together with the push towards the mandatory use of a JCA connector (in place of the plain JDBC implementation) in JBoss TS 5.x, a step backward. Please note that I've not followed this evolution so tightly, but this is what I understood based on the feedback I received on the bugs I opened myself (and for some of which I also contributed with patches that were never integrated). Thanks in advance.",,,,,
"Hi Mauro, I found the link, it doesn't seem like you have signed the CLA, please can you consider doing to assist in integrating your future patches? https://cla.jboss.org (choose ""JBoss Transactions"") Thanks, Tom",,,,,
"Hi Tom, thanks a lot for your feedback. Two questions: - I'm evaluating the CLA with my employer to sign a corporate CLA, thank you; just a question: in the form at http://cla.jboss.org there's also a text field where I can specify a JIRA ticket; should I need to fill in the form for each ticket I want to contribute or is it just a hint to the first/most important ticket I want to contribute? - is (or will be) there any documentation available where there is an explanation of the migration path from JBoss TS 4.x to 5.x? I mean, from a system integrator point of view, rather than from a consumer point of view (as I said, we're embedding JBoss TS in our own application and we had to integrate it in our Spring+JDBC+pooling environment - not a 2-minute trivial task) Thanks in advance.",,,,,
Does this still make sense? We should probably ensure our tooling is consistent with AS7 as much as anything.,,,,,
"Hi Mike, This issue was marked as ""Resolved, Done"" but there is no ""Fix Version"" specified. Please can you update the Jira with the version of the software where you fixed this? Also, can you then close the issue (assuming its not an in development version). Thanks, Tom",,,,,
"From Adrian Brock: ""Adrian comment: ""Will this also be integrated with the JBoss installer and the JBoss Network for ""ease"" of installation/choice? i.e. we include JBoss Transactions in the installer distrubtion and let them choose between the two implementations.""",,,,,
"The comment 'TODO why?' is probably because the shutdown code has not yet been tested. It is clear that this routine needs to be called by the RecoveryManagerImple and not by your code -- the RecoveryManager implementation should clean up its own detritus. However, after a cursory eyeball of the code I believe the current version of ExpiredEntryMonitor needs to be supplemented with some synchronization. It should ensure that the shutdown call does not clear _started and return before the thread held in _theInstance has exited. If it does and then startup() is called it will be possible for the old thread to start processing a new scanner list. Synchronization issues aside, it is probably bad form for RecoveryManagerImple to return from stop when it has not really stopped a thread which it started. If you need to get this to work just now then I suggest you either i) implement and test a version of shutdown which performs the required synchronization, call it from RecoveryManagerimple.stop(), then send us your patch for inclusion in a future release (we are very glad to accept contributions from those who know what they are doing). or ii) bodge it as you indicated above and wait for us to release a tested version",,,,,
"Hi Andrew, any news on this? Could it be considered for 4.7.0?",,,,,
"new Uid (""invalidString"", true); should return cleanly with a Uid such that x.valid()== false. Instead it throws NPE. The exception handling probably needs a catch for that in addition to the existing exceptions it knows about.",,,,,
"Hi Romain, If you still would like this fix, please can you consider raising a pull request on the Narayana project and we can take a look at it. The new build system uses maven so you could add pmd into a profile and don't enable that profile by default? Thanks, Tom PS If you no longer require this feature please consider closing this issue and marking as deferred",,,,,
"Another thought about the Listener.finalize() method: it is useless also because if the Listener is running, it can't be finalized, so finalize() will never be called. Viceversa, if finalize() is called it means that the listener has already been stopped, so its finalize() implementation is useless... am I wrong?",,,,,
Could this be targetted for 4.7.0? Resolution should be quite straightforward... Thanks in advance.,,,,,
"Given that right now this problem is causing a memory leak whenever JBossJTA is restarted, any thought on a candidate target release? Thanks in advance.",,,,,
"Maybe running the test with the gc.log and analysing it afterwards would also be a sounded approach ? Basically what is to know of the test is : ""Is there memory consumption below a certain threshold ?"", this could be answer by a gc.log file... (However, this is rather tied to the Sun JVM implementation). Moreover, analysing the GC log also allow to see how the memory consumtion progress, maybe spotting a memory consumption rising (even if it's stay beneath the appropriate threshold during the test) that wasn't rising in the previous version. That gain this sort of knowledge would requires you to either run test on previous tag release or keep previous GC.log on file, however doing the first one with Git is not really that complicated (in fact, it will be similar to using the 'bissect' command). On other ""trick"" that I know of is the Ant's for-each statement in the ant-contrib.jar, which will allow to do something like this: <for-each ..> <junit .... > <!-- run one particular test or test group --> <!-- Load memory configuration for an appropriate test from a properties file --> <property name=""${testId}-config..""/> <jvmarg value=""-Xms${memory.start}""/> <jvmarg value=""-Xmx${memory.max}""/> <!-- ... Hope that's help.",,,,,
"This says ""Done"" but there is no information. Is it done or WONTFIX? If it is done, what is the command-line tool and what is the syntax for using it?",,,,,
"Hi Richard This does not make much sense to me. JBAS-4238 and JBTM-66 are similar but not equivalent. The JBAS issue is addressed in both releases, but JBossAS 4.2.3 uses TS 4.2.3.SP7, which does not have the JBTM-66 changes. JBossTS AS 5.1.0.GA uses TS 4.6.1.GA , which does. So, you seem to be having problems due to a behaviour change that you requested in the first place?! Ah well, maybe I misunderstood what you wanted. Do you have any preference between the implementation alternatives I outline in http://community.jboss.org/message/515473 assuming either will address your needs?",,,,,
"Jonathan, Thanks for your response. I'm sorry if I haven't been clear in my description of the problem. I'm not convinced JBoss AS 5.1.0.GA actually includes JBTM-66, though I understand JIRA seems to indicate it does. The fact remains that I (and others, by the look of it) are seeing transaction RollbackExceptions *that do not include their root cause* when using JBoss 5.1.0.GA. For example, I see: --- 08:48:35,468 http-127.0.0.1-8080-6 DEBUG [SQL] delete from Resource where id=? and version=? 08:48:35,484 http-127.0.0.1-8080-6 WARN [JDBCExceptionReporter] SQL Error: 1451, SQLState: 23000 08:48:35,484 http-127.0.0.1-8080-6 ERROR [JDBCExceptionReporter] Cannot delete or update a parent row: a foreign key constraint fails (`avant-ss-production/bug`, CONSTRAINT `FK106546DD208B6` FOREIGN KEY (`assignedTo_id`) REFERENCES `resource` (`id`)) 08:48:35,484 http-127.0.0.1-8080-6 ERROR [AbstractFlushingEventListener] Could not synchronize database state with session org.hibernate.exception.ConstraintViolationException: could not delete: [com.avant.ss.ejb.entity.Staff#4028818126273479012627c550d60004] at org.hibernate.exception.SQLStateConverter.convert(SQLStateConverter.java:94) at org.hibernate.exception.JDBCExceptionHelper.convert(JDBCExceptionHelper.java:66) at org.hibernate.persister.entity.AbstractEntityPersister.delete(AbstractEntityPersister.java:2569) at org.hibernate.persister.entity.AbstractEntityPersister.delete(AbstractEntityPersister.java:2725) at org.hibernate.action.EntityDeleteAction.execute(EntityDeleteAction.java:97) at org.hibernate.engine.ActionQueue.execute(ActionQueue.java:279) at org.hibernate.engine.ActionQueue.executeActions(ActionQueue.java:263) at org.hibernate.engine.ActionQueue.executeActions(ActionQueue.java:172) at org.hibernate.event.def.AbstractFlushingEventListener.performExecutions(AbstractFlushingEventListener.java:321) at org.hibernate.event.def.DefaultFlushEventListener.onFlush(DefaultFlushEventListener.java:50) at org.hibernate.impl.SessionImpl.flush(SessionImpl.java:1027) at org.hibernate.impl.SessionImpl.managedFlush(SessionImpl.java:365) at org.hibernate.ejb.AbstractEntityManagerImpl$1.beforeCompletion(AbstractEntityManagerImpl.java:504) at com.arjuna.ats.internal.jta.resources.arjunacore.SynchronizationImple.beforeCompletion(SynchronizationImple.java:101) at com.arjuna.ats.arjuna.coordinator.TwoPhaseCoordinator.beforeCompletion(TwoPhaseCoordinator.java:269) at com.arjuna.ats.arjuna.coordinator.TwoPhaseCoordinator.end(TwoPhaseCoordinator.java:89) at com.arjuna.ats.arjuna.AtomicAction.commit(AtomicAction.java:177) at com.arjuna.ats.internal.jta.transaction.arjunacore.TransactionImple.commitAndDisassociate(TransactionImple.java:1423) at com.arjuna.ats.internal.jta.transaction.arjunacore.BaseTransaction.commit(BaseTransaction.java:137) at com.arjuna.ats.jbossatx.BaseTransactionManagerDelegate.commit(BaseTransactionManagerDelegate.java:75) at org.jboss.aspects.tx.TxPolicy.endTransaction(TxPolicy.java:170) at org.jboss.aspects.tx.TxPolicy.invokeInOurTx(TxPolicy.java:87) at org.jboss.aspects.tx.TxInterceptor$Required.invoke(TxInterceptor.java:190) at org.jboss.aop.joinpoint.MethodInvocation.invokeNext(MethodInvocation.java:102) at org.jboss.aspects.tx.TxPropagationInterceptor.invoke(TxPropagationInterceptor.java:76) at org.jboss.aop.joinpoint.MethodInvocation.invokeNext(MethodInvocation.java:102) at org.jboss.ejb3.security.RunAsSecurityInterceptorv2.invoke(RunAsSecurityInterceptorv2.java:94) at org.jboss.aop.joinpoint.MethodInvocation.invokeNext(MethodInvocation.java:102) at org.jboss.ejb3.security.RoleBasedAuthorizationInterceptorv2.invoke(RoleBasedAuthorizationInterceptorv2.java:201) at org.jboss.aop.joinpoint.MethodInvocation.invokeNext(MethodInvocation.java:102) at org.jboss.ejb3.security.Ejb3AuthenticationInterceptorv2.invoke(Ejb3AuthenticationInterceptorv2.java:186) at org.jboss.aop.joinpoint.MethodInvocation.invokeNext(MethodInvocation.java:102) at org.jboss.ejb3.ENCPropagationInterceptor.invoke(ENCPropagationInterceptor.java:41) at org.jboss.aop.joinpoint.MethodInvocation.invokeNext(MethodInvocation.java:102) at org.jboss.ejb3.BlockContainerShutdownInterceptor.invoke(BlockContainerShutdownInterceptor.java:67) at org.jboss.aop.joinpoint.MethodInvocation.invokeNext(MethodInvocation.java:102) at org.jboss.aspects.currentinvocation.CurrentInvocationInterceptor.invoke(CurrentInvocationInterceptor.java:67) at org.jboss.aop.joinpoint.MethodInvocation.invokeNext(MethodInvocation.java:102) at org.jboss.ejb3.session.SessionSpecContainer.invoke(SessionSpecContainer.java:176) at org.jboss.ejb3.session.SessionSpecContainer.invoke(SessionSpecContainer.java:216) at org.jboss.ejb3.proxy.impl.handler.session.SessionProxyInvocationHandlerBase.invoke(SessionProxyInvocationHandlerBase.java:207) at org.jboss.ejb3.proxy.impl.handler.session.SessionProxyInvocationHandlerBase.invoke(SessionProxyInvocationHandlerBase.java:164) at $Proxy354.delete(Unknown Source) at com.kennardconsulting.core.faces.controller.PersistentEntityController.delete(PersistentEntityController.java:259) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at org.apache.el.parser.AstValue.invoke(AstValue.java:170) at org.apache.el.MethodExpressionImpl.invoke(MethodExpressionImpl.java:276) at javax.faces.component.MethodBindingMethodExpressionAdapter.invoke(MethodBindingMethodExpressionAdapter.java:88) at com.sun.faces.application.ActionListenerImpl.processAction(ActionListenerImpl.java:102) at com.kennardconsulting.core.faces.application.ActionListenerImpl.processAction(ActionListenerImpl.java:120) at javax.faces.component.UICommand.broadcast(UICommand.java:387) at org.ajax4jsf.component.AjaxViewRoot.processEvents(AjaxViewRoot.java:324) at org.ajax4jsf.component.AjaxViewRoot.broadcastEvents(AjaxViewRoot.java:299) at org.ajax4jsf.component.AjaxViewRoot.processPhase(AjaxViewRoot.java:256) at org.ajax4jsf.component.AjaxViewRoot.processApplication(AjaxViewRoot.java:469) at com.sun.faces.lifecycle.InvokeApplicationPhase.execute(InvokeApplicationPhase.java:82) at com.sun.faces.lifecycle.Phase.doPhase(Phase.java:100) at com.sun.faces.lifecycle.LifecycleImpl.execute(LifecycleImpl.java:118) at javax.faces.webapp.FacesServlet.service(FacesServlet.java:265) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206) at org.apache.myfaces.webapp.filter.ExtensionsFilter.doFilter(ExtensionsFilter.java:341) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206) at org.ajax4jsf.webapp.BaseXMLFilter.doXmlFilter(BaseXMLFilter.java:178) at org.ajax4jsf.webapp.BaseFilter.handleRequest(BaseFilter.java:290) at org.ajax4jsf.webapp.BaseFilter.processUploadsAndHandleRequest(BaseFilter.java:388) at org.ajax4jsf.webapp.BaseFilter.doFilter(BaseFilter.java:515) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206) at com.kennardconsulting.core.servlet.EjbRemoveFilter.doFilter(EjbRemoveFilter.java:44) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206) at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:235) at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191) at org.jboss.web.tomcat.security.SecurityAssociationValve.invoke(SecurityAssociationValve.java:190) at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:525) at org.jboss.web.tomcat.security.JaccContextValve.invoke(JaccContextValve.java:92) at org.jboss.web.tomcat.security.SecurityContextEstablishmentValve.process(SecurityContextEstablishmentValve.java:126) at org.jboss.web.tomcat.security.SecurityContextEstablishmentValve.invoke(SecurityContextEstablishmentValve.java:70) at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127) at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102) at org.jboss.web.tomcat.service.jca.CachedConnectionValve.invoke(CachedConnectionValve.java:158) at org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:567) at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109) at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:330) at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:829) at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:598) at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:447) at java.lang.Thread.run(Thread.java:619) Caused by: com.mysql.jdbc.exceptions.MySQLIntegrityConstraintViolationException: Cannot delete or update a parent row: a foreign key constraint fails (`avant-ss-production/bug`, CONSTRAINT `FK106546DD208B6` FOREIGN KEY (`assignedTo_id`) REFERENCES `resource` (`id`)) at com.mysql.jdbc.SQLError.createSQLException(SQLError.java:931) at com.mysql.jdbc.MysqlIO.checkErrorPacket(MysqlIO.java:2985) at com.mysql.jdbc.MysqlIO.sendCommand(MysqlIO.java:1631) at com.mysql.jdbc.MysqlIO.sqlQueryDirect(MysqlIO.java:1723) at com.mysql.jdbc.Connection.execSQL(Connection.java:3256) at com.mysql.jdbc.PreparedStatement.executeInternal(PreparedStatement.java:1313) at com.mysql.jdbc.PreparedStatement.executeUpdate(PreparedStatement.java:1585) at com.mysql.jdbc.PreparedStatement.executeUpdate(PreparedStatement.java:1500) at com.mysql.jdbc.PreparedStatement.executeUpdate(PreparedStatement.java:1485) at org.jboss.resource.adapter.jdbc.WrappedPreparedStatement.executeUpdate(WrappedPreparedStatement.java:365) at org.hibernate.persister.entity.AbstractEntityPersister.delete(AbstractEntityPersister.java:2551) ... 90 more 08:48:35,515 http-127.0.0.1-8080-6 DEBUG [ResourceBean] Destructed com.kennardconsulting.core.ejb.session.ResourceBean@11611dc 08:48:35,546 http-127.0.0.1-8080-6 DEBUG [ResourceBean] Constructed com.kennardconsulting.core.ejb.session.ResourceBean@18227b1 08:48:35,546 http-127.0.0.1-8080-6 DEBUG [ResourceBean] Loading 'RKennard'... 08:48:35,546 http-127.0.0.1-8080-6 DEBUG [ResourceBean] JPA-QL: select a from Staff a where a.name = :name (cacheable) 08:48:35,546 http-127.0.0.1-8080-6 DEBUG [ResourceBean] JPA-QL: name: 'RKennard' 08:48:35,546 http-127.0.0.1-8080-6 DEBUG [SQL] select staff0_.id as id1_, staff0_1_.dateCreated as dateCrea2_1_, staff0_1_.dateUpdated as dateUpda3_1_, staff0_1_.updatedBy as updatedBy1_, staff0_1_.version as version1_, staff0_1_.name as name1_, staff0_1_.firstLoginDate as firstLog7_1_, staff0_1_.password as password1_, staff0_.firstname as firstname43_, staff0_.surname as surname43_, staff0_.title as title43_ from Staff staff0_ inner join Resource staff0_1_ on staff0_.id=staff0_1_.id where staff0_1_.name=? 08:48:35,546 http-127.0.0.1-8080-6 DEBUG [ResourceBean] ...loaded 'RKennard' 08:48:35,562 http-127.0.0.1-8080-6 DEBUG [ResourceBean] Loading '4028818126273479012627c550d60004' (Staff)... 08:48:35,562 http-127.0.0.1-8080-6 DEBUG [SQL] select staff0_.id as id1_0_, staff0_1_.dateCreated as dateCrea2_1_0_, staff0_1_.dateUpdated as dateUpda3_1_0_, staff0_1_.updatedBy as updatedBy1_0_, staff0_1_.version as version1_0_, staff0_1_.name as name1_0_, staff0_1_.firstLoginDate as firstLog7_1_0_, staff0_1_.password as password1_0_, staff0_.firstname as firstname43_0_, staff0_.surname as surname43_0_, staff0_.title as title43_0_ from Staff staff0_ inner join Resource staff0_1_ on staff0_.id=staff0_1_.id where staff0_.id=? 08:48:35,562 http-127.0.0.1-8080-6 DEBUG [ResourceBean] ...loaded '4028818126273479012627c550d60004' (_/>%ü'""&<_ <noo>Admin) 08:48:35,562 http-127.0.0.1-8080-6 DEBUG [CoreFacesUtils] FacesError: javax.faces.FacesException: #{staff.delete}: java.lang.RuntimeException: javax.ejb.EJBTransactionRolledbackException: Transaction rolled back at com.sun.faces.application.ActionListenerImpl.processAction(ActionListenerImpl.java:118) at com.kennardconsulting.core.faces.application.ActionListenerImpl.processAction(ActionListenerImpl.java:120) at javax.faces.component.UICommand.broadcast(UICommand.java:387) at org.ajax4jsf.component.AjaxViewRoot.processEvents(AjaxViewRoot.java:324) at org.ajax4jsf.component.AjaxViewRoot.broadcastEvents(AjaxViewRoot.java:299) at org.ajax4jsf.component.AjaxViewRoot.processPhase(AjaxViewRoot.java:256) at org.ajax4jsf.component.AjaxViewRoot.processApplication(AjaxViewRoot.java:469) at com.sun.faces.lifecycle.InvokeApplicationPhase.execute(InvokeApplicationPhase.java:82) at com.sun.faces.lifecycle.Phase.doPhase(Phase.java:100) at com.sun.faces.lifecycle.LifecycleImpl.execute(LifecycleImpl.java:118) at javax.faces.webapp.FacesServlet.service(FacesServlet.java:265) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206) at org.apache.myfaces.webapp.filter.ExtensionsFilter.doFilter(ExtensionsFilter.java:341) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206) at org.ajax4jsf.webapp.BaseXMLFilter.doXmlFilter(BaseXMLFilter.java:178) at org.ajax4jsf.webapp.BaseFilter.handleRequest(BaseFilter.java:290) at org.ajax4jsf.webapp.BaseFilter.processUploadsAndHandleRequest(BaseFilter.java:388) at org.ajax4jsf.webapp.BaseFilter.doFilter(BaseFilter.java:515) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206) at com.kennardconsulting.core.servlet.EjbRemoveFilter.doFilter(EjbRemoveFilter.java:44) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206) at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:235) at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191) at org.jboss.web.tomcat.security.SecurityAssociationValve.invoke(SecurityAssociationValve.java:190) at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:525) at org.jboss.web.tomcat.security.JaccContextValve.invoke(JaccContextValve.java:92) at org.jboss.web.tomcat.security.SecurityContextEstablishmentValve.process(SecurityContextEstablishmentValve.java:126) at org.jboss.web.tomcat.security.SecurityContextEstablishmentValve.invoke(SecurityContextEstablishmentValve.java:70) at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127) at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102) at org.jboss.web.tomcat.service.jca.CachedConnectionValve.invoke(CachedConnectionValve.java:158) at org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:567) at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109) at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:330) at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:829) at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:598) at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:447) at java.lang.Thread.run(Thread.java:619) Caused by: javax.faces.el.EvaluationException: java.lang.RuntimeException: javax.ejb.EJBTransactionRolledbackException: Transaction rolled back at javax.faces.component.MethodBindingMethodExpressionAdapter.invoke(MethodBindingMethodExpressionAdapter.java:102) at com.sun.faces.application.ActionListenerImpl.processAction(ActionListenerImpl.java:102) ... 41 more Caused by: java.lang.RuntimeException: javax.ejb.EJBTransactionRolledbackException: Transaction rolled back at com.kennardconsulting.core.faces.controller.PersistentEntityController.delete(PersistentEntityController.java:275) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at org.apache.el.parser.AstValue.invoke(AstValue.java:170) at org.apache.el.MethodExpressionImpl.invoke(MethodExpressionImpl.java:276) at javax.faces.component.MethodBindingMethodExpressionAdapter.invoke(MethodBindingMethodExpressionAdapter.java:88) ... 42 more Caused by: javax.ejb.EJBTransactionRolledbackException: Transaction rolled back at org.jboss.ejb3.tx.Ejb3TxPolicy.handleEndTransactionException(Ejb3TxPolicy.java:54) at org.jboss.aspects.tx.TxPolicy.endTransaction(TxPolicy.java:175) at org.jboss.aspects.tx.TxPolicy.invokeInOurTx(TxPolicy.java:87) at org.jboss.aspects.tx.TxInterceptor$Required.invoke(TxInterceptor.java:190) at org.jboss.aop.joinpoint.MethodInvocation.invokeNext(MethodInvocation.java:102) at org.jboss.aspects.tx.TxPropagationInterceptor.invoke(TxPropagationInterceptor.java:76) at org.jboss.aop.joinpoint.MethodInvocation.invokeNext(MethodInvocation.java:102) at org.jboss.ejb3.security.RunAsSecurityInterceptorv2.invoke(RunAsSecurityInterceptorv2.java:94) at org.jboss.aop.joinpoint.MethodInvocation.invokeNext(MethodInvocation.java:102) at org.jboss.ejb3.security.RoleBasedAuthorizationInterceptorv2.invoke(RoleBasedAuthorizationInterceptorv2.java:201) at org.jboss.aop.joinpoint.MethodInvocation.invokeNext(MethodInvocation.java:102) at org.jboss.ejb3.security.Ejb3AuthenticationInterceptorv2.invoke(Ejb3AuthenticationInterceptorv2.java:186) at org.jboss.aop.joinpoint.MethodInvocation.invokeNext(MethodInvocation.java:102) at org.jboss.ejb3.ENCPropagationInterceptor.invoke(ENCPropagationInterceptor.java:41) at org.jboss.aop.joinpoint.MethodInvocation.invokeNext(MethodInvocation.java:102) at org.jboss.ejb3.BlockContainerShutdownInterceptor.invoke(BlockContainerShutdownInterceptor.java:67) at org.jboss.aop.joinpoint.MethodInvocation.invokeNext(MethodInvocation.java:102) at org.jboss.aspects.currentinvocation.CurrentInvocationInterceptor.invoke(CurrentInvocationInterceptor.java:67) at org.jboss.aop.joinpoint.MethodInvocation.invokeNext(MethodInvocation.java:102) at org.jboss.ejb3.session.SessionSpecContainer.invoke(SessionSpecContainer.java:176) at org.jboss.ejb3.session.SessionSpecContainer.invoke(SessionSpecContainer.java:216) at org.jboss.ejb3.proxy.impl.handler.session.SessionProxyInvocationHandlerBase.invoke(SessionProxyInvocationHandlerBase.java:207) at org.jboss.ejb3.proxy.impl.handler.session.SessionProxyInvocationHandlerBase.invoke(SessionProxyInvocationHandlerBase.java:164) at $Proxy354.delete(Unknown Source) at com.kennardconsulting.core.faces.controller.PersistentEntityController.delete(PersistentEntityController.java:259) ... 49 more Caused by: javax.transaction.RollbackException: [com.arjuna.ats.internal.jta.transaction.arjunacore.commitwhenaborted] [com.arjuna.ats.internal.jta.transaction.arjunacore.commitwhenaborted] Could not commit transaction. at com.arjuna.ats.internal.jta.transaction.arjunacore.TransactionImple.commitAndDisassociate(TransactionImple.java:1435) at com.arjuna.ats.internal.jta.transaction.arjunacore.BaseTransaction.commit(BaseTransaction.java:137) at com.arjuna.ats.jbossatx.BaseTransactionManagerDelegate.commit(BaseTransactionManagerDelegate.java:75) at org.jboss.aspects.tx.TxPolicy.endTransaction(TxPolicy.java:170) ... 72 more Caused by: java.lang.Throwable: setRollbackOnly called from: at com.arjuna.ats.internal.jta.transaction.arjunacore.TransactionImple.setRollbackOnly(TransactionImple.java:392) at com.arjuna.ats.internal.jta.transaction.arjunacore.BaseTransaction.setRollbackOnly(BaseTransaction.java:195) at com.arjuna.ats.jbossatx.BaseTransactionManagerDelegate.setRollbackOnly(BaseTransactionManagerDelegate.java:123) at org.hibernate.ejb.AbstractEntityManagerImpl.markAsRollback(AbstractEntityManagerImpl.java:421) at org.hibernate.ejb.AbstractEntityManagerImpl.throwPersistenceException(AbstractEntityManagerImpl.java:576) at org.hibernate.ejb.AbstractEntityManagerImpl.throwPersistenceException(AbstractEntityManagerImpl.java:614) at org.hibernate.ejb.AbstractEntityManagerImpl$1.beforeCompletion(AbstractEntityManagerImpl.java:513) at com.arjuna.ats.internal.jta.resources.arjunacore.SynchronizationImple.beforeCompletion(SynchronizationImple.java:101) at com.arjuna.ats.arjuna.coordinator.TwoPhaseCoordinator.beforeCompletion(TwoPhaseCoordinator.java:269) at com.arjuna.ats.arjuna.coordinator.TwoPhaseCoordinator.end(TwoPhaseCoordinator.java:89) at com.arjuna.ats.arjuna.AtomicAction.commit(AtomicAction.java:177) at com.arjuna.ats.internal.jta.transaction.arjunacore.TransactionImple.commitAndDisassociate(TransactionImple.java:1423) ... 75 more --- You can see in this log that: 1. at 08:48:35,468 I try to delete a database row that has a foreign key constraint. 2. at 08:48:35,484 Hibernate raises a ConstraintViolationException, which gets logged 3. at 08:48:35,562 an Exception reaches the Java Server Faces UI. It contains a javax.ejb.EJBTransactionRolledbackException, but the stack trace stops at 'setRollbackOnly called from:' So the rollback exception does not include the original ConstraintViolationException root cause, which is what JBTM-66 was asking for. Perhaps I didn't ask for it very well, for which I apologise. Not including the root cause makes it difficult for UIs to display user-friendly error messages. All I can say is 'transaction error'. If I had the root cause I could say 'database error', or better yet 'item is relied upon by other items'. I agree crossing JVM boundaries is a whole other problem, but that is not my use case. Thanks for your help, Richard.",,,,,
"at com.arjuna.ats.jbossatx.BaseTransactionManagerDelegate.setRollbackOnly(BaseTransactionManagerDelegate.java:123) at org.hibernate.ejb.AbstractEntityManagerImpl.markAsRollback(AbstractEntityManagerImpl.java:421) at org.hibernate.ejb.AbstractEntityManagerImpl.throwPersistenceException(AbstractEntityManagerImpl.java:576) at org.hibernate.ejb.AbstractEntityManagerImpl.throwPersistenceException(AbstractEntityManagerImpl.java:614) at org.hibernate.ejb.AbstractEntityManagerImpl$1.beforeCompletion(AbstractEntityManagerImpl.java:513) What's key here is that, from the transaction manager's perspective, the setRollbackOnly call precedes the exception - hibernate sets the tx to rollback before throwing the exception. So, the setRollbackOnly call IS the root cause of the transaction rolling back. JBTM-66 is not only present but functioning exactly as designed. As mentioned in the forum thread, this is arguably misuse of the api by hibernate. Of the alternatives proposed in the forum thread, chaining the deferredThrowable to the rollbackOnly trace won't work, as there is no deferredThrowable at the point in time that the setRollbackOnly call is made. So the only viable alternative seems to be using the deferredThrowable as the initCause of the rollback in preference to the rollbackOnlyCallerStackTrace in cases where both are available. Will that meet your needs?",,,,,
"Jonathan, Brilliant. As long as I can navigate the stack trace from the javax.ejb.EJBTransactionRolledbackException to the MySQLIntegrityConstraintViolationException (or at least the ConstraintViolationException) that would be awesome. I am happy to be the guinea pig and test this if you can work up a JAR for JBoss AS 5.1.0. Regards, Richard.",,,,,
"Jonathan, Actually I have no problem asking Hibernate to stop messing with causality, if that is what is happening. Perhaps this broke in JBoss 5.1.0 not because of a JBTM change but because of a Hibernate change? Could you please tell me which classes (even line numbers?) are suspect within the Hibernate code, and I will raise a JIRA with that team. Regards, Richard.",,,,,
"Johathan, can I ask you another question on a related topic(one that does not involve the client at all). If a business method in EJB session bean throws a RuntimeException in the JBoss log I see only this line: 11:32:12,550 ERROR [TxPolicy] javax.ejb.EJBTransactionRolledbackException No cause, no message, no nothing - the RuntimeException is however successfully relayed to the client, but I remember that in older JBoss version I used to get I full stack trace with the javax.ejb.EJBTransactionRolledbackException. What might be causing this problem?",,,,,
"Jonathan, As you asked, I asked someone from the Hibernate team (Steve Ebersole) about casuality. Steve has since responded, as have a couple other people. What is our next step to getting this resolved? Regards, Richard.",,,,,
"Was this fixed or not? I can't tell from the JIRA or the forum post. Assuming that it was, I will write this release note: Cause: In ArjunaCore which was included in JBoss Application Server 4.2 and previous, when a transaction rolled back, the <systemitem>RollbackException</systemitem> included the root cause of the exception. In JBoss Application Server 5.1, the exception no longer included this information, even though the information could still be found in a different area of the log file. Consequence: Developers who relied on the information included in the <systemitem>RollbackException</systemitem> in the older versions of JBoss Application Server found that their applications no longer worked as expected. Fix: The debugging information has been put back into the exception, so that it works as it did previously. Result: Developers can once again write code to take advantage of the debugging information found in the <systemitem>RollbackException</systemitem>.",,,,,
"I have not had chance yet to try this fix (I assume it will be in JBoss AS 6?) but I would like to thank everyone for their hard work on addressing it, especially as it was an unpopular request and 'went against the grain' of people's preferred architecture. I look forward to my code saying sensible error messages once again! Richard.",,,,,
LogFactoryInterface yields a AbstractLogInterface - how does one get from LogI18n to AbstractLogInterface? I confess this logging infrastructure is pretty baffling to me,,,,,
"I stuck with LogI18n initially because it was unclear how LogFactory can receive resource bundle information. I guess the key to solving resource bundles will indeed be some kind of nifty subclassing as we are limited to a single resource bundle instance per category. Would you consider simply moving to java.util.logging wholesale, and removing all the facade stuff completely? And by ""you"" I guess I mean ""me"", since it's my dumb idea. The only practical difficulty I see would be that I'd have to add a Level class so that you have DEBUG/TRACE instead of JUL's FINE/FINER/FINEST, but that's not too big a deal. The upside would be removing the dep on commons-logging and deleting a bunch of classes. At first glance I think the resource generation stuff would work OK with JUL.",,,,,
"Introduced a set of *EnvironmentBean classes and updated code to use them instead of accessing the property manager directly. The beans have hardcoded defaults that are overridden with values from the property manager (i.e. properties file / system properties ) when the bean is instantiated. Thereafter the bean is independent of the property manager. A handful of property manager usage remains, esp. in the orb portability layer which uses dynamically named properties that are difficult to map to fixed beans. Needs some further thought. Some more thought also needed to: capturing running config, since it's not necessarily the same as what's in the properties file. Some sort of bean state dumper, similar to what the module Info classes do? even stronger type safety - e.g. some beans have hostnames vs. InetAddresses, lists of classnames vs lists of classes - consider impact on injection systems and JMX API. dynamic reconfig mechanism - should updating bean properties automatically restart relevant parts of the system e.g. rebind listeners to new port without requiring full restart? but that's all for the next cycle. For now the type safety improvements are enough progress.",,,,,
huh? we already do - the syncs records are ordered and you can register one even during beforeCompletion as long as the new one has a order later in the sequence that the current one.,,,,,
"Having BasicAction put a timestamp in to its serialized data should work. Tricky questions like: should it be the time the tx was started? prepared? last written out, i.e. may change if the tx is partially recovered and then rewitten to the store? But the basic read/write of the timestamp should be pretty straightforward.",,,,,
"Hi Mike, Trying to work out whether this is something we want to support on 4.16.x branch right now. Do you know if it is fixed in 4.16.x yet? e.g. hoping to put 4.16.1 out on Friday and hopefully that would be the last version for EAP6. Tom",,,,,
"When I come to release 4.16.1 it is going to ask me what to do with this bug, is it in a state that it can be closed or does it need to move to 4.16.2 (or ideally 5.0.0.M2)?",,,,,
Is this bug resolved in 4.6.1.CP13?,,,,,
I fixed it in a private branch of JBOSSTS_4_6_1_GA_CP12. I am not aware of any CP13 branch. The details are in https://issues.jboss.org/browse/JBTM-522 including a link to the hudson job that tests the functionality. Has there been a decision on whether the backport will go into a 4.6.1 release? When/if it does then we should ask QA to include it in there test plan.,,,,,
Can we mark this as complete?,,,,,
"I looked at this from the perspective of EAP, i.e., what docs are needed there versus only needed in the community. TS docs outline for EAP distribution: In: 0..1 InstallGuide 1..1 ReleaseNodes (JIRA generated) FailureRecovery Guide Administration Guide (ArjunaCore as basis, with diffs from JTA and JTS) Programmers Guide (ArjunaCore with all TXOJ aspects removed; start with JTA) Separate Programmers guide for JTS and XTS (maybe separate Admin guides then?) Separate all JTS and XTS information into separate documents? JTS Quickstart Guide (should be expanded to cover JTA) Configuration guide (Administration Guide update) Out: Debugging documentation All TXOJ aspects from documentation Maybe: None. Duplicated: Tooling discussions Debugging discussions ObjectStore setup Errors",,,,,
Always check JIRA in case there's something similar (same?) there already ;-) Feel free to close one of them.,,,,,
"Marks description from the duplicate issue: {quote} We're working on WS-BA based compensation annotations. That's great, but can we refactor so that we can support compensations outside of WS-BA? ArjunaCore can support compensations without Web Services. Maybe the WS-BA annotations vanish entirely, or collapse down to a subset of what currently exists to support what is truly unique about WS-BA? {quote}",,,,,
"Are you sure the remote tests are actually running? Looks to me like they are turned off, hence no coverage. <target name=""run.tests""> ... <exclude name=""**/remote/**""/> ... </target>",,,,,
"[~tomjenkinson], what would you think about postponing this issue until JBTM-2571 is resolved? I think it'd be too dangerous to remove public classes or methods without having code coverage from all available tests. What do you think?",,,,,
"I have implemented draft 4 of the specification that resides at http://www.jboss.org/reststar/specifications/transactions.html with some amendments (documented in the docs directory). What's left: - hook it into the build releases target of JBossTS; - port the ""Night out"" demo from the previous REST-tx prototype; - track updates to the specification",,,,,
"Hi Paul, Is there any update on this one? Is it covered by any QS? Tom",,,,,
"Hi [~paul.robinson], Is there any update on this? We can't understand what is needed here. What is a standalone client in this context? Tom",,,,,
"Is there any documentation that explains what is going on here? Will JBossTS be still usable for JDBC connections? In what would consist the migration? We're using JBossTS in a JTA infrastructure where database queries are done through JDBC. The client code just uses JDBC connections (obtained through the transactional driver), while the global JTA transaction is controlled using Spring JTA transaction manager. The JBossTS backend, through the transactional driver and some of our glue code, is obtaining JTA connections through XA data sources created using the DynamicClass mechanism. We're working outside JEE, just plain Tomcat + JBossTS + Spring. How will the scenario change with JCA?",,,,,
The controlling property is com.arjuna.ats.arjuna.recovery.recoveryListener (in bean RecoveryEnvironmentBean). With a socket based recovery manager the TM/RM can easily detect whether another RM is managing an object store. Changing the default puts the onus on the user to make sure that only one RM is managing it. So my question is: is it the intention to make the user responsible for getting it right?,,,,,
"Would the same problem exist if you opened up two RMs on different ports but against the same ObjectStore? If so, +1 on the user getting it right.",,,,,
Release Note: Cause: The finalizer was not needed in the Statemanager. Consequence: ?? Fix: The finalizer was removed from the StateManager. Result: The finalizer is no longer in the StateManager.,,,,,
"Email from Jonathan re ArjunaTA: On 10/20/2010 11:39 PM, Misty Stanley-Jones wrote: > However, what would be IMMENSELY helpful is for someone to go through the Installation and Administration guides and highlight differences for me. well the JTA ones are simple... Install Guide: identical to core except for using ArjunaTA instead of ArjunaCore as the name throughout. Assuming that token is already parameterized in the core's docbook .xml the job's pretty much done already. P.S. IIRC the ArjunaTA name arose because of some legal hassle with using the term 'JTA' in that context. Anyone happen to know if that's still an issue and if so, have any good ideas for a better name? Admin Guide: as above, except: - extra section: 'prerequisites' basically saying you need to read the core docs too. Eventually we'll actually merge the docs and that paragraph will vanish but for now it probably needs keeping. - extra list entry in the xml code block for the RecoveryEnvironmentBean.recoveryExtensions in the peroidic recovery section. - extra para at the end: 'selecting the JTA implementation' I'll take a look at the JTS ones tomorrow. Jonathan.",,,,,
"Email from Jonathan re ArjunaJTS: JTS install guide is same as core except name and: - add first and last bullet point paras for 'preparing your system' section - add 'specifying the ORB to use' and 'the interface repository' sections' - the 'loading the distribution' section is obsolete, just junk it. - add 'installing into non-default location' section - operating system services needs additional note on PUT_JACORB_HOME_HERE - additional 'web services component' section. JTS admin guide is same as core except name and: - intro paragraph adds mention of web services - add 'OTS/J2EE transaction service management' (except it's now 'Java EE' not 'J2EE') - add 'web service transaction management' section - in periodic recovery section, RecoveryEnvironmentBean.recoveryExtensions module list is wrong for JTS - it should be per the xml in ArjunaJTS/jbossts-properties-arjunajts.xml - add 'orb specific configurations' section - add 'initialising JBossTS applications' section side note: the docs dialect is actually 'en_GB' not 'en_US', hence 'initialising' not 'initializing' and such. What is the company policy on this - do we need to standardise it? The docbook layout seems to assume the canonical version is en_US. Likewise A4 vs. US letter for pdf page size. Jonathan.",,,,,
"I'm in the process of validating the trace output from these tests and I think doing this automatically is not going to be a trivial process. I have some ideas around how the byteman scripts can be re-factored to simplify the validation process and to also improve scalability so that we can introduce more complex, multi-party tests. Therefore I am removing the requirement to validate the trace output from this issue. Validation will come in a later release. Hopefully this will turn this issue into a much more straight forward task. So to confirm, the requirements for this issue are to: # Run the tests as part of the AS7 testsuite (as per Ivo's pattern: https://github.com/istudens/jboss-as/compare/xts_tests#diff-0) # Automate the running of each crash recovery test without any Byteman rules. This provides some test coverage and ensures we have a valid system before the Byteman rules are applied. # Automate each valid combination of Byteman script to TestCase. The Byteman scripts specify which tests are available. # Gather the output from all test runs in separate files for ""eyeball validation"". Until this validation is automated, I (with the help of Andrew initially) will do this validation. The output files should be named ""<bytman script name>:<test class name>"". For example: ""ATCrashDuringCommit.MultiParticipantPrepareAndCommitTest"". Amos: does this make sense? Is this in line with how you are currently implementing the feature?",,,,,
"Also, I don't think we need Arquillian to crash the app server as Byteman is doing that for us. This is good as Arquillian is unlikely to have this feature as part of a JBoss AS release soon enough. Amos: Does this make sense, or am I missing something?",,,,,
"Hi, Please can you confirm that I am right in thinking you mean that we should remove the version numbers from the remaining dependencies in maven/pom-template.xml where they have a corresponding version number in the AS7 pom tree? Ta",,,,,
Isn't this duplicated by JBTM-1451?,,,,,
"Further to previous comment ... for instance what do we (or customers) expect from the statistics gathering routines in this new environment? Should it be measuring all transactions created and terminated in the JVM, or on a per transaction manager basis?",,,,,
"To address Davids requirement we need to support 1xArjunaCore (for the MSC) and 1xArjunaJTA||ArjunaJTS (for the EJB container). The problem is the recovery manager, are we expecting to launch two of those in the same VM? I presume we have to in order to cleanly separate the MSC from the EJB container (e.g. different object stores)",,,,,
"Why would we need to recovery managers? As long as the transactions are unique and things like the nodename are shared by recovery, it should be possible to have one instance.",,,,,
"Allowing multiple TMs in the same JVM is a generic statement and although WF needs this, there may be other users who want it for different reasons. I think we should either define this as a generic problem which we can try to solve for other use cases (do we know them all?) or we should refocus this solely on the WF use case and then come back to a more general requirement if/when it comes back up.",,,,,
"Modified demo so it works on AS7. This required moving the wsdl and handler xml around because AS7 won't load them from class-relative paths like it used to (like it ought to?). Also had to add module dependencies to org.jboss.xts for the client and org.jboss.xts + org.jboss.jts to the service (for example, it uses Uid from TS) Finally had to modify the context serialize/deserialize helper so it install the XTS module classloader on the thread before trying to invoke JAXB. This is necessary to ensure we can load the relevant JAXB implementation.",,,,,
"Firstly some background. It is possible to configure different stores for different purposes. Each store is a singleton so each store type is shared. We currently use at least four stores (XTS uses some others): - an action store for transaction and participant logs; - a recovery store (which defaults to the action store); - a state store for use with TxOj and is not used with JTA (or JTS); - a communications store for storing connectivity information such as ORB endpoints or transaction manager status items. Calling arjPropertyManager.getObjectStoreEnvironmentBean() looks up the default store and is equivalent to: BeanPopulator.getNamedInstance(ObjectStoreEnvironmentBean.class, ""default"") and is used to configure the action store. The other stores can be configured by looking up a specific named ObjectStoreEnvironmentBean. Use ""default"" or ""stateStore"" to configure the action and state stores respectively. Use ""communicationStore"" to configure the communications store. So the actual bug/feature is that looking up the default store environment bean via the properties manager (arjPropertyManager.getObjectStoreEnvironmentBean()) should return a bean that will configure all stores. Howeve this could be risky (for example it could interfere with XTS behaviour) so my preference would be to force the user to be specific about which stores he wants an environment bean for by making the getObjectStoreEnvironmentBean call take the store name as a parameter. But that leaves the difficult issue of how to specify which store to use in the properties file <entry key=""ObjectStoreEnvironmentBean.objectStoreType"">XYZStore</entry> since this entry is only applied to the default store. We could simply document the behaviour in jbossts-properties.xml and tell users to explicitly set the communications store programatically if required. So the communications store type would have to be set as follows: BeanPopulator.getNamedInstance(ObjectStoreEnvironmentBean.class, ""communicationStore"").setObjectStoreType(com.arjuna.ats.internal.arjuna.objectstore.VolatileStore.class.getName()); Is this latter approach acceptable to all concerned?",,,,,
"Thanks Mike, I presume you have confirmed nothing is created on disk in that scenario? Perhaps your resolution could be to update the documentation in the ArjunaCore programmers guide (or wherever it is we document ObjectStores) in the github (head/trunk/master whatever you want to call it) version. Note, do not add it to the documentation under docs/ as that is platform docs and this ObjectStore feature is not supported in EAP",,,,,
"Could you please increase the priority of this bug, or at least give it some sort of schedule? Defect analysis becomes a nightmare without any sort of exception chaining.",,,,,
"Hi Andrew, hi Jonathan, what is the fix version that includes the whole fix? 4.14? Thanks in advance!",,,,,
Steps: * Agree on suitable set. * Ensure they are testable and tested via Hudson. * Non-standalone ones need a way of grabbing the AS deps * Must follow the AS7 quickstart rules,,,,,
"Thanks Andrew, I think that we need to make this clearer to the user somehow. Maybe we can update the readme.txt to clarify where the emma.jar in ext is coming from?",,,,,
Does this work? Are you ready to create a pull request?,,,,,
Yeah I think we can either defer this issue or simply close it (and re-open later if we ever want to revisit the issue). Agreed?,,,,,
"Hi Paul, I don't think EAP5 support is something we should drive any longer, if you are happy this is resolved on EAP6 can we update the fixversions, subject etc and resolve and close this one? Thanks, Tom",,,,,
"[~tomjenkinson], these test still don't work. Shall I investigate further or keep them ignored?",,,,,
"Yeah, I considered the tx reaper, but what about if the timeout is 0?",,,,,
"The main questions I have are: 1. where would this file be written to, is it ok to write to current working directory? 2. the XID would have this integer in its bqual, therefore, are there possibly none-TS tools that would want to read the bqual and need to read meaningful information regarding the EIS without the benefit of our utility classes?",,,,,
Do we need pseudo support for idlj? [tom@tomsfc15 JBOSSTS_4_15_0_Final]$ find . -name \*idl -exec grep -l pseudo {} \; ./install/jacorb/idl/omg/Corba.idl ./install/jacorb/idl/omg/orb.idl ./install/jacorb/idl/omg/CosTSPortability.idl ./install/jacorb/idl/omg/CosNaming.old.idl ./install/jacorb/idl/omg/PortableServer.idl ./ArjunaJTS/build/install/jacorb/idl/omg/Corba.idl ./ArjunaJTS/build/install/jacorb/idl/omg/orb.idl ./ArjunaJTS/build/install/jacorb/idl/omg/CosTSPortability.idl ./ArjunaJTS/build/install/jacorb/idl/omg/CosNaming.old.idl ./ArjunaJTS/build/install/jacorb/idl/omg/PortableServer.idl ./ArjunaJTS/jacorb/idl/omg/Corba.idl ./ArjunaJTS/jacorb/idl/omg/orb.idl ./ArjunaJTS/jacorb/idl/omg/CosTSPortability.idl ./ArjunaJTS/jacorb/idl/omg/CosNaming.old.idl ./ArjunaJTS/jacorb/idl/omg/PortableServer.idl,,,,,
"When creating the jobs, you can probably copy: http://172.17.131.2/view/Narayana+BlackTie/job/narayana-java6/ and http://172.17.131.2/view/Narayana+BlackTie/job/narayana-java7/ Maybe rename the old jobs narayana-jacorb-java6 and the new job narayana-idlj-java6 and so on",,,,,
Will it work on OpenJDK?,,,,,
"Ah, ok. So what you are saying is that this will work on Hudson as you have fixed this problem before for other jobs?",,,,,
"Paul, what CI environment did you mean in your comment [1]? Yes, I was talking about Hudson as it is the primary environment for QE testing. If I run the tests locally on my laptop I usually don't need headless mode as I want to see how the test is going and thus see its actions performed in Firefox in front of my eyes. This is the reason why the tests look so at the moment. But I can change them to better fit to your requirements. On Hudson if you want to run a selenium test you need to enable 'Run Xvnc during build' and select some of selenium slaves at 'Label Expression'. Then the selenium test should work. [1] https://issues.jboss.org/browse/JBTM-948?focusedCommentId=12661667&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12661667",,,,,
We have such a thing in place now as far as I can see. Let's close this?,,,,,
"Hi Amos, is this closed?",,,,,
"Quick notes after Andrew explained the XTS structure to me: {quote} XTS project layout WS-AS, Activity service (needed? - yes but need to know why) WS-CF (general purpose context management), useful WS-C Client and coordinator side impl of the oasis standard (current) Activation and registration service WS-T oasis TX protocol specific services for client, coord, ws negotiation (WS-AT and WS-BA) WS-TX JBoss specific APIs which drive WS-C and WS-T services {quote}",,,,,
"what is the setup of your test? If I have a single JBoss server talking to oracle then it works fine. When I try the following scenario is when I get the problem (both server 4.0.3 SP1 and JBossts 4.2): Server1 : starts the global distributed transaction, performs local oracle database operations and calls a server2Bean on server2 // this method has the tx ""required"" attribute in ejb-jar.xml performGlobalTx(){ doSomething(); // do oracle operations server2Bean.doSomething(); // call remote jboss Server2 } Server2: the bean on this server updates the same oracle database: doSomething(){ performDBOperations...; // here is where I get the exceptions reported in the forum <<<<--------------------here }",,,,,
Playing Devil's Advocate: and what happens to certain modules that are only every touched by one person who may not like the specific code style?,,,,,
"{quote} Playing Devil's Advocate: and what happens to certain modules that are only every touched by one person who may not like the specific code style? {quote} This causes problems as you can't put checks in the build process to prevent rogue-formatted code from being committed. It also makes it harder, should another developer need to work on this module as they need to ensure they don't apply the common code format. I don't personally like the AS7 code format, but I have to use it when i work on the AS7 codebase. However, I'd be happy to get used to it if we get the benefits of a common style in Narayana.",,,,,
"I think this should apply to all modules hanging off the root narayana pom. The following statements should be taken assuming we do decide to reformat: I don't think we have any modules that fulfil the property of being isolated to the single developer degree, some could be at the moment but in the long term are very unlikely to be. Incubator style modules - e.g. STM - where there is a single developer working on it at the moment, probably don't need the formatting *right now*, but before they become .Final and as such become community supported I believe they would need to follow the consistent style as the developer has contributed that work to the public domain and adhering to a formatting will make it easier for other developers to then submit patches/pull reqs. Also, a note to the above statement, if we don't like the AS7 style potentially we could develop our own (negating one positive which would is consistency with AS7). I am of the opinion of where I don't really mind what the code looks like (within reason) so long as it all looks the same?",,,,,
"{quote} Also, a note to the above statement, if we don't like the AS7 style potentially we could develop our own (negating one positive which would is consistency with AS7). I am of the opinion of where I don't really mind what the code looks like (within reason) so long as it all looks the same? {quote} There's nothing wrong with the AS7 style (IMO). I am the one with the problem as I am not familiar with that codestyle. I'm sure that over time I would get used the the AS7 style and no longer like my current style.",,,,,
"In case the fpaste expires: {code} package org.jboss.wsf.stack.cxf.interceptor; import javax.management.ObjectName; import javax.xml.ws.WebServiceContext; import javax.xml.ws.handler.MessageContext; import org.apache.cxf.jaxws.context.WrappedMessageContext; import org.jboss.wsf.spi.SPIProviderResolver; import org.jboss.wsf.spi.classloading.ClassLoaderProvider; import org.jboss.wsf.spi.deployment.Endpoint; import org.jboss.wsf.spi.deployment.Reference; import org.jboss.wsf.spi.invocation.EndpointAssociation; import org.jboss.wsf.spi.management.EndpointRegistry; import org.jboss.wsf.spi.management.EndpointRegistryFactory; public class XTSHandler { //.... public Object getEndpointInstance() { Endpoint endpoint = EndpointAssociation.getEndpoint(); Reference ref = endpoint.getInstanceProvider().getInstance(endpoint.getTargetBeanName()); return ref.getValue(); } public Object getEndpointInstanceCXF(MessageContext ctx) { Endpoint endpoint = ((WrappedMessageContext)ctx).getWrappedMessage().getExchange().get(Endpoint.class); Reference ref = endpoint.getInstanceProvider().getInstance(endpoint.getTargetBeanName()); return ref.getValue(); } public Object getEndpointInstanceCXF(WebServiceContext ctx) { return getEndpointInstanceCXF(ctx.getMessageContext()); } public Object getEndpointInstanceUsingRegistry() { ClassLoader cl = ClassLoaderProvider.getDefaultProvider().getServerIntegrationClassLoader(); EndpointRegistryFactory eprFac = SPIProviderResolver.getInstance(cl).getProvider().getSPI(EndpointRegistryFactory.class, cl); EndpointRegistry registry = eprFac.getEndpointRegistry(); Endpoint endpoint = null; for (ObjectName on : registry.getEndpoints()) { Endpoint ep = registry.getEndpoint(on); //somehow identify your endpoint... name? address? if (ep.getAddress().equals(""...."")) { endpoint = ep; } //... } Reference ref = endpoint.getInstanceProvider().getInstance(endpoint.getTargetBeanName()); return ref.getValue(); } } {code}",,,,,